### SEA NODES MARKER
widget = {
	name = "sea_node_marker"
	datacontext = "[SeaNodeMarker]"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[GetPlayer]"
	allow_outside = yes

	container = {
		parentanchor = center
		resizeparent = yes

		### network interaction
		button = {
			alwaystransparent = yes
			size = { 250% 250% }
			alpha = 0.8
			texture ="gfx/interface/map_markers/round_highlight_orange.dds"
			visible = "[And(SeaNodeMarker.IsValidInteractionNode, SeaNodeMarker.IsActiveInteractionNode)]"
			onclick = "[SeaNodeMarker.SelectInteractionClick]"
			parentanchor = center
			position = { 0 0 }
		}
		### network interaction
		button = {
			alwaystransparent = yes
			size = { 250% 250% }
			alpha = 0.8
			texture ="gfx/interface/map_markers/round_highlight_green.dds"
			visible = "[And(SeaNodeMarker.IsValidInteractionNode, Not(SeaNodeMarker.IsActiveInteractionNode))]"
			onclick = "[SeaNodeMarker.SelectInteractionClick]"
			parentanchor = center
			position = { 0 0 }
		}
		#convoy raiding
		icon = {
			visible = "[SeaNodeMarker.HasAnyShippingLaneDamaged( GetPlayer )]"
			size = { 180% 180% }
			texture = "gfx/interface/map_markers/convoy_raiding_highlight.dds"
			alwaystransparent = yes
			parentanchor = center
		}

		#highlight - when generally highlighted
		icon = {
			visible = "[SeaNodeMarker.IsSeaNodeHighlighted]"
			size = { 120% 120% }
			texture = "gfx/interface/map_markers/round_highlight.dds"
			alwaystransparent = yes
			parentanchor = center
		}

		#highlight - selected
		icon = {
			visible = "[SeaNodeMarker.IsSelected]"
			size = { 140% 140% }
			texture = "gfx/interface/map_markers/round_highlight.dds"
			alwaystransparent = yes
			parentanchor = center
		}

		### ZOOM FAR
		container = {
			visible = "[IsZoomLevelFar]"

			### no supply
			button = {
				visible = "[And(Not(SeaNodeMarker.ShouldShowInteraction), Not(SeaNodeMarker.HasActiveSupplyNetwork))]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 15 15 }
				parentanchor = center
				alpha = 0.5
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
			}

			### no supply - in interaction
			button = {
				alwaystransparent = yes
				visible = "[And(SeaNodeMarker.ShouldShowInteraction, Not(SeaNodeMarker.HasActiveSupplyNetwork))]"
				onclick = "[SeaNodeMarker.SelectInteractionClick]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 15 15 }
				parentanchor = center
				alpha = 0.5
			}

			### has supply
			button = {
				onmousehierarchyenter = "[AccessHighlightManager.HighlightSupplyNetwork(Country.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
				visible = "[And(Not(SeaNodeMarker.ShouldShowInteraction), SeaNodeMarker.HasActiveSupplyNetwork)]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 18 18 }
				parentanchor = center
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
			}

			### has supply - in interaction
			button = {
				alwaystransparent = yes
				visible = "[And(SeaNodeMarker.ShouldShowInteraction, SeaNodeMarker.HasActiveSupplyNetwork)]"
				onclick = "[SeaNodeMarker.SelectInteractionClick]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 18 18 }
				parentanchor = center
			}

			### selected / interface panel opened
			widget = {
				onmousehierarchyenter = "[AccessHighlightManager.HighlightSupplyNetwork(Country.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
				size = { 100% 100% }
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
				
				icon = {
					visible = "[SeaNodeMarker.IsSelected]"
					size = { 25 25 }
					texture = "gfx/interface/main_hud/selected_arrow.dds"
					position = { 0 5 }
					parentanchor = hcenter
					alwaystransparent = yes
				}
			}
		}

		### ZOOM NEAR
		container = {
			visible = "[Not(IsZoomLevelFar)]"

			### no supply
			button = {
				visible = "[And(Not(SeaNodeMarker.ShouldShowInteraction), Not(SeaNodeMarker.HasActiveSupplyNetwork))]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				gfxtype = buttongfx
				effectname = "NoHighlight"
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 25 25 }
				parentanchor = center
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
			}

			### no supply - in interaction
			button = {
				alwaystransparent = yes
				visible = "[And(SeaNodeMarker.ShouldShowInteraction, Not(SeaNodeMarker.HasActiveSupplyNetwork))]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				gfxtype = buttongfx
				effectname = "NoHighlight"
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 25 25 }
				parentanchor = center
			}

			### has supply
			button = {
				onmousehierarchyenter = "[AccessHighlightManager.HighlightSupplyNetwork(Country.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
				visible = "[And(Not(SeaNodeMarker.ShouldShowInteraction), SeaNodeMarker.HasActiveSupplyNetwork)]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				gfxtype = buttongfx
				effectname = "NoHighlight"
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 30 30 }
				parentanchor = center
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
			}

			### has supply - in interaction
			button = {
				alwaystransparent = yes
				visible = "[And(SeaNodeMarker.ShouldShowInteraction, SeaNodeMarker.HasActiveSupplyNetwork)]"
				onclick = "[SeaNodeMarker.SelectClick]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				gfxtype = buttongfx
				effectname = "NoHighlight"
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				size = { 30 30 }
				parentanchor = center
			}

			### selected / interface panel opened
			widget = {
				onmousehierarchyenter = "[AccessHighlightManager.HighlightSupplyNetwork(Country.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
				size = { 100% 100% }
				icon = {
					visible = "[SeaNodeMarker.IsSelected]"
					size = { 35 35 }
					texture = "gfx/interface/main_hud/selected_arrow.dds"
					position = { 0 15 }
					parentanchor = hcenter
					alwaystransparent = yes
				}
				using = tooltip_above
				tooltip = "[SeaNodeMarker.GetSupplyNetworkTooltip]"
			}
		}
	}
}

### SEA NODE MOVEMENT MARKER
widget = {
	name = "sea_node_movement_marker"
	layer = layer_map_markers
	allow_outside = yes
	max_update_rate = 8

	container = {
		parentanchor = center
		resizeparent = yes
		onmousehierarchyenter = "[GetVariableSystem.Set(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID), 'true')]"
		onmousehierarchyleave = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
		allow_outside = yes
		tooltip = "SEA_NODE_MOVEMENT_MARKER_TOOLTIP"

		movement_marker_hover_vfx = {
			visible = "[And(GetVariableSystem.Exists(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID)), SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode)]"
		}

		movement_marker_click_vfx = {}

		### Green circle highlight
		button = {
			visible = "[SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode]"
			size = { 250% 250% }
			alpha = 0.8
			onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
			onrightclick = "[Execute( SeaNodeMovementMarker.GetSeaNode.GetDeploySelectedFormationsCommand )]"
			onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
			onrightclick = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
			rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_sea_node"
			parentanchor = center
			position = { 0 0 }
			texture ="gfx/interface/map_markers/round_highlight_green.dds"
		}

		### Node hover highlight
		icon = {
			visible = "[And(GetVariableSystem.Exists(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID)), Not(SeaNodeMovementMarker.IsAllSelectedFormationsTarget))]"
			size = { 120% 120% }
			texture = "gfx/interface/map_markers/round_highlight.dds"
			alwaystransparent = yes
			parentanchor = center
		}

		### Node hover highlight
		icon = {
			visible = "[SeaNodeMovementMarker.IsAllSelectedFormationsTarget]"
			size = { 140% 140% }
			texture = "gfx/interface/map_markers/round_highlight_blue.dds"
			alwaystransparent = yes
			parentanchor = center
		}

		### ZOOM FAR
		container = {
			visible = "[IsZoomLevelFar]"

			### no supply - with right-click
			button = {
				visible = "[And(Not(SeaNodeMovementMarker.HasActiveSupplyNetwork), SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode)]"
				parentanchor = center
				size = { 15 15 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				onrightclick = "[Execute( SeaNodeMovementMarker.GetSeaNode.GetDeploySelectedFormationsCommand )]"
				onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
				onrightclick = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
				rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_sea_node"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				alpha = 0.5
			}

			### has supply - with right-click
			button = {
				visible = "[And(SeaNodeMovementMarker.HasActiveSupplyNetwork, SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode)]"
				parentanchor = center
				size = { 18 18 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				onrightclick = "[Execute( SeaNodeMovementMarker.GetSeaNode.GetDeploySelectedFormationsCommand )]"
				onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
				onrightclick = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
				rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_sea_node"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
			}

			### no supply - without right-click
			button = {
				visible = "[And(Not(SeaNodeMovementMarker.HasActiveSupplyNetwork), Not(SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode))]"
				parentanchor = center
				size = { 15 15 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				alpha = 0.5
			}

			### has supply - without right-click
			button = {
				visible = "[And(SeaNodeMovementMarker.HasActiveSupplyNetwork, Not(SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode))]"
				parentanchor = center
				size = { 18 18 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
			}
		}

		### ZOOM NEAR
		container = {
			visible = "[Not(IsZoomLevelFar)]"

			### no supply - with right-click
			button = {
				visible = "[And(Not(SeaNodeMovementMarker.HasActiveSupplyNetwork), SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode)]"
				parentanchor = center
				size = { 25 25 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				onrightclick = "[Execute( SeaNodeMovementMarker.GetSeaNode.GetDeploySelectedFormationsCommand )]"
				onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
				onrightclick = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
				rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_sea_node"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				alpha = 0.5
			}

			### has supply - with right-click
			button = {
				visible = "[And(SeaNodeMovementMarker.HasActiveSupplyNetwork, SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode)]"
				parentanchor = center
				size = { 30 30 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				onrightclick = "[Execute( SeaNodeMovementMarker.GetSeaNode.GetDeploySelectedFormationsCommand )]"
				onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
				onrightclick = "[GetVariableSystem.Clear(Concatenate('sea_node_movement_marker_highlight', SeaNodeMovementMarker.GetSeaNode.GetID))]"
				rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_sea_node"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
			}

			### no supply - without right-click
			button = {
				visible = "[And(Not(SeaNodeMovementMarker.HasActiveSupplyNetwork), Not(SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode))]"
				parentanchor = center
				size = { 25 25 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				texture = "gfx/interface/map_markers/sea_node.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
				alpha = 0.5
			}

			### has supply - without right-click
			button = {
				visible = "[And(SeaNodeMovementMarker.HasActiveSupplyNetwork, Not(SeaNodeMovementMarker.CanDeploySelectedFormationsToSeaNode))]"
				parentanchor = center
				size = { 30 30 }
				onclick = "[InformationPanelBar.OpenSeaRegionPanelTab(SeaNodeMovementMarker.GetSeaNode.Self, 'navy')]"
				texture = "gfx/interface/map_markers/sea_node_have_supply.dds"
				using = sea_node_framed_button_gfx
				using = default_button_animation
				using = select_button_sound
				framesize = { 60 60 }
			}
		}
	}
}

### MARKETS
container = {
	name = "market_marker"
	datacontext = "[MarketsMarker.GetAnyMarket]"
	layer = layer_map_markers
	max_update_rate = 8
	onmousehierarchyenter = "[AccessHighlightManager.HighlightMarket(Market.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	alwaystransparent = no
	parentanchor = bottom|hcenter

	icon = {
		texture = "gfx/interface/map_markers/market_frame_top.dds"
		size = { 105 32 }
		position = { 0 5 }
		parentanchor = top|hcenter
		visible = "[Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted)]"
	}
	icon = {
		texture = "gfx/interface/map_markers/market_frame_bottom.dds"
		size = { 145 34 }
		parentanchor = bottom|hcenter
		visible = "[Market.IsBeingHighlighted]"
	}

	flowcontainer = {
		direction = vertical
		parentanchor = hcenter

		small_flag = {
			datacontext = "[Market.GetOwner]"
			parentanchor = hcenter
			visible = "[Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted)]"
			blockoverride "onhover" {}
		}

		tiny_flag = {
			datacontext = "[Market.GetOwner]"
			parentanchor = hcenter
			visible = "[Not(Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted))]"
			blockoverride "onhover" {}
		}
		button = {
			onclick = "[InformationPanelBar.OpenMarketPanelTab(Market.Self, 'default')]"
			onrightclick = "[RightClickMenuManager.ShowForMarket(Market.AccessSelf)]"
			visible = "[Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted)]"
			using = default_button
			using = default_list_position

			flowcontainer = {
				resizeparent = yes
				margin = { 19 8 }
				margin_bottom = 9

				textbox = {
					raw_text = "#BOLD [Market.GetNameNoFormatting]#!"
					minimumsize = { 120 -1 }
					autoresize = yes
					align = hcenter|nobaseline
					multiline = yes
					elide = right
				}
			}
		}
	}
}

template is_not_colonizable_and_has_either_relations_or_relationship_change {
	visible = "[Or(And(Not(Country.IsColonizable), NotZero(Country.GetRelationsWith( GetPlayer ))), NotZero_CFixedPoint(Country.GetDailyRelationsProgress(GetPlayer)))]"
}

template visible_diplomatic_marker_show_extra_info
{
	visible = "[Or(NotZero_CFixedPoint(Country.GetAttitudeTowards(GetPlayer).CalcScore), NotZero(Country.GetRelationsWith( GetPlayer )))]"
}

### WORLD MARKET HUB
container = {
	name = "world_market_hub_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[BuildingMarker.GetBuilding.GetState]"
	datacontext = "[BuildingMarker.GetBuilding.GetState.GetMarket]"
	parentanchor = bottom|hcenter

	tooltip = "STATE_WORLD_MARKET_ACCESS_DESC"

	onmousehierarchyenter = "[SetTempMapModeByKey('mm_market_areas')]"
	onmousehierarchyleave = "[RemoveTempMapMode]"
	alwaystransparent = no

	icon = {
		texture = "gfx/interface/backgrounds/round_button_bg.dds"
		visible = "[And(Not(Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted)), NotZero(State.GetTradeCapacity))]"
		size = { 30 30 }

		icon = {
			texture = "gfx/interface/icons/generic_icons/world_market.dds"
			parentanchor = center
			size = { 20 20 }
		}
	}

	icon = {
		texture = "gfx/interface/backgrounds/round_button_bg.dds"
		visible = "[And(Or(ObjectsEqual(Market.GetOwner, GetPlayer.Self), Market.IsBeingHighlighted), NotZero(State.GetTradeCapacity))]"
		size = { 45 45 }

		icon = {
			texture = "gfx/interface/icons/generic_icons/world_market.dds"
			parentanchor = center
			size = { 35 35 }
		}
	}
}

### COUNTRY DIPLOMACY
container = {
	name = "country_diplomacy_marker"
	datacontext = "[CountryMarker.GetCountry]"
	layer = layer_map_markers
	max_update_rate = 8
	
	flowcontainer = {
		visible = "[Not(Country.IsLocalPlayer)]"
		minimumsize = { 23 23 }
		
		tiny_flag = {
			parentanchor = vcenter
			using = visible_diplomatic_marker_show_extra_info
		}

		background = {
			using = colored_panel_dark
			margin = { 5 1 }
			margin_right = 5
			using = visible_diplomatic_marker_show_extra_info
		}

		# DIPLOMATIC PACTS
		flowcontainer = {
			datamodel = "[Country.AccessActiveDiplomaticPactTypes]"
			parentanchor = vcenter
			using = visible_diplomatic_marker_show_extra_info
			
			item = {
				flowcontainer = {
					datamodel = "[ContextualDiplomaticActionType.AccessCountry.AccessActiveDiplomaticPacts( ContextualDiplomaticActionType.Self )]"
					item = {
						flowcontainer = {
							visible = "[ObjectsEqual(GetPlayer.Self, ContextualDiplomaticPact.GetOtherCountry)]"
							margin_left = 4

							icon = {
								size = { 25 25 }
								texture = "[ContextualDiplomaticActionType.GetDiplomaticActionType.GetTexture]"
								tooltip = "[ContextualDiplomaticPact.GetTooltip]"
								using = tooltip_above
							}
						}
					}
				}
			}
		}

		flowcontainer = {
			parentanchor = vcenter
			spacing = 5
			margin_top = 1
			using = visible_diplomatic_marker_show_extra_info
			margin_left = 4

			# ATTITUDE
			widget = {
				size = { 23 23 }
				parentanchor = vcenter
				visible = "[Not(Country.IsColonizable)]"
				
				icon = {
					size = { 100% 100% }
					texture = "gfx/interface/icons/ai_attitude_icons/human.dds"
					visible = "[Country.IsPlayer]"
					tooltip = "ai_attitude_human_tooltip"
				}

				icon = {
					size = { 100% 100% }
					texture = "[Country.GetAttitudeTowards(GetPlayer).GetTexture]"
					visible = "[Not(Country.IsPlayer)]"
					tooltip = "[Country.GetAttitudeTowards(GetPlayer).GetTooltip]"
				}
			}

			vertical_divider = {
				visible = "[Or(NotZero(Country.GetRelationsWith( GetPlayer )), NotZero_CFixedPoint(Country.GetDailyRelationsProgress(GetPlayer)))]"
			}

			# TENSION
			flowcontainer = {
				visible = "[Country.IsColonizable]"
				parentanchor = vcenter
				textbox = {
					tooltip = "[GetPlayer.GetTensionTooltip( Country.Self )]"
					margin_left = 3
					text = "[Country.GetTensionWith(GetPlayer)|-]"
					autoresize = yes
					align = hcenter|nobaseline
					parentanchor = vcenter
					minimumsize = { 23 23 }
					visible = "[NotZero(Country.GetTensionWith( GetPlayer ))]"
				}
			}

			# RELATIONS
			flowcontainer = {
				margin_right = 2
				using = is_not_colonizable_and_has_either_relations_or_relationship_change
				parentanchor = vcenter
				spacing = 2
				
				textbox = {
					tooltip = "COUNTRY_RELATIONS_TOOLTIP"
					text = "[Country.GetRelationsWith( GetPlayer )|+=]"
					autoresize = yes
					align = hcenter|nobaseline
					minimumsize = { 23 23 }
					parentanchor = vcenter
				}
				textbox = {
					visible = "[GreaterThan_CFixedPoint( Country.GetDailyRelationsProgress(GetPlayer), '(CFixedPoint)0' )]"
					raw_text = "@arrow_up!"
					autoresize = yes
					align = nobaseline
					parentanchor = vcenter
				}

				textbox = {
					visible = "[LessThan_CFixedPoint( Country.GetDailyRelationsProgress(GetPlayer), '(CFixedPoint)0' )]"
					raw_text = "@arrow_down!"
					autoresize = yes
					align = nobaseline
					parentanchor = vcenter	
				}
			}
		}
	}
}

### INFRASTRUCTURE IN TRADE LENS
container = {
	name = "state_infra_marker"
	layer = layer_map_markers
	max_update_rate = 8
	tooltip = "[StateInfraMarker.GetTooltip]"
	parentanchor = bottom|hcenter

	### ISOLATED
	background = {
		visible = "[Not(StateInfraMarker.IsConnectedMarker)]"
		texture = "gfx/interface/map_markers/state_to_state_infra.dds"
		spriteType = Corneredtiled
		spriteborder = { 20 20 }
		texture_density = 2
		shaderfile = "gfx/FX/pdxgui_default.shader"
		alpha = 0.85

		modify_texture = {
			texture = "gfx/interface/backgrounds/gradient_overlay.dds"
			spriteType = Corneredstretched
			spriteborder = { 0 0 }
			blend_mode = overlay
			alpha = 0.8
		}
		modify_texture = {
			texture = "gfx/interface/textures/default_noise_texture.dds"
			spriteType = Corneredtiled
			spriteborder = { 0 0 }
			blend_mode = overlay
		}
	}

	### IN MARKET
	background = {
		visible = "[StateInfraMarker.IsConnectedMarker]"
		texture = "gfx/interface/map_markers/state_to_state_infra_linked.dds"
		spriteType = Corneredtiled
		spriteborder = { 20 20 }
		texture_density = 2
		shaderfile = "gfx/FX/pdxgui_default.shader"
		alpha = 0.85

		modify_texture = {
			texture = "gfx/interface/backgrounds/gradient_overlay.dds"
			spriteType = Corneredstretched
			spriteborder = { 0 0 }
			blend_mode = overlay
			alpha = 0.8
		}
		modify_texture = {
			texture = "gfx/interface/textures/default_noise_texture.dds"
			spriteType = Corneredtiled
			spriteborder = { 0 0 }
			blend_mode = overlay
		}
	}

	flowcontainer = {
		margin = { 8 4 }

		### MARKET ACCESS WARNING
		textbox = {
			visible = "[And(And(StateInfraMarker.IsConnectedMarker, LessThan_CFixedPoint(StateInfraMarker.GetState.GetMarketAccess, '(CFixedPoint)1')), GreaterThan_CFixedPoint(StateInfraMarker.GetState.GetMarket.GetMarketSharePercentageFor( GetPlayer.Self ), '(CFixedPoint)0'))]"
			text = "MARKET_ACCESS_WARNING"
			autoresize = yes
			align = hcenter|nobaseline
		}

		### ISOLATED MARKET
		textbox = {
			visible = "[Not(StateInfraMarker.IsConnectedMarker)]"
			text = "ISOLATED"
			autoresize = yes
			align = hcenter|nobaseline
		}
	}
}


### INFRASTRUCTURE IN TRADE LENS
button = {
	name = "sea_infra_marker"
	layer = layer_map_markers
	max_update_rate = 8
	tooltip = "[SeaRegionInfraMarker.GetTooltip]"
	parentanchor = bottom|hcenter

	### SEA REGION
	background = {
		texture = "gfx/interface/map_markers/state_to_state_infra_water.dds"
		spriteType = Corneredtiled
		spriteborder = { 20 20 }
		texture_density = 2
		shaderfile = "gfx/FX/pdxgui_default.shader"
		alpha = 0.85

		modify_texture = {
			texture = "gfx/interface/backgrounds/gradient_overlay.dds"
			spriteType = Corneredstretched
			spriteborder = { 0 0 }
			blend_mode = overlay
			alpha = 0.8
		}
		modify_texture = {
			texture = "gfx/interface/textures/default_noise_texture.dds"
			spriteType = Corneredtiled
			spriteborder = { 0 0 }
			blend_mode = overlay
		}
	}

	flowcontainer = {
		resizeparent = yes
		margin = { 10 6 }

		### SEA REGION
		textbox = {
			visible = "[And(LessThan_CFixedPoint(SeaRegionInfraMarker.GetStateRegion.GetSeaInfrastructure(GetPlayer), '(CFixedPoint)100'), GreaterThan_CFixedPoint(SeaRegionInfraMarker.GetStateRegion.GetSeaInfrastructure(GetPlayer), '(CFixedPoint)0'))]"
			text = "MARKET_ACCESS_WARNING_SEA"
			autoresize = yes
			align = hcenter|nobaseline
		}
	}
}


### SITUATIONS
container = {
	name = "event_marker"
	datacontext = "[EventMarker.GetAnyEvent]"
	tooltip = "[Event.GetTooltip]"
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	button_icon_round_big = {
		size = { 35 35 }
		onclick = "[PopupManager.OpenEvent(EventMarker.AccessAnyEvent)]"

		round_progress_default = {
			parentanchor = center
			size = { 31 31 }
			tooltip = "DEFAULT_EVENT_OPTION"
			value = "[Event.GetPercentageRemainingDays]"
		}

		icon = {
			texture = "[Event.GetEventIcon]"
			parentanchor = center
			size = { 25 25 }

			background = {
				using = blurry_dark_background
			}
		}
	}

	widget = {
		size = { 100% 100% }

		icon = {
			visible = "[Or( Or(Event.HasCategory('enactment'), Event.HasCategory('revolution')), LessThanOrEqualTo_int32( Event.GetNumRemainingDays, '(int32)60'))]"
			using = highlighted_circle_selection_small
			size = { 110% 110% }
		}
	}
}

### WAR GOAL
container = {
	name = "war_goal_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[WarGoalMarker.AccessWarGoal]"
	alwaystransparent = no
	onmousehierarchyenter = "[WarGoal.ShowHighlight]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

	tooltipwidget = {
		RegularTooltip_WarGoal = {}
	}

	background = {
		using = colored_panel_dark
		color = "[WarGoal.GetHolder.GetMapColor]"
	}

	wargoal_item = {
		visible = "[And(IsZoomLevelNear,WarGoal.GetWar.IsParticipant( GetMetaPlayer.GetPlayedOrObservedCountry.Self ))]"
	}

	widget = {
		size = { 44 44 }
		visible = "[And(Not(IsZoomLevelNear),WarGoal.GetWar.IsParticipant( GetMetaPlayer.GetPlayedOrObservedCountry.Self ))]"

		button = {
			visible = "[And(Not(IsMapModeSelected( 'mm_designate_strategic_objective' )), IsValid( WarGoal.ToggleIsPressedInPotentialPeaceDeal( GetPlayer.Self ) ))]"
			enabled = "[WarGoal.IsValid]"
			onclick = "[Execute( WarGoal.ToggleIsPressedInPotentialPeaceDeal( GetPlayer.Self ) )]"
			using = default_button
			size = { 100% 100% }

			icon = {
				visible = no
				#todo add the below visible state instead when PRCAL-17690 is done:
	 			#visible = "[WarGoal.IsBeingHighlighted]"
	  			using = highlighted_square_selection
	  		}
		}

		icon = {
			size = { 40 40 }
			texture = "[WarGoal.GetTexture]"
			parentanchor = center
		}

		wargoal_checkmark = {
			blockoverride "position" {
				position = { 0 0 }
			}
			background = {
				using = blurry_dark_background
			}
		}
	}
}

### STRATEGIC REGION
container = {
	name = "strategic_region_marker"
	ignoreinvisible = yes
	onmousehierarchyenter = "[AccessHighlightManager.HighlightStrategicRegion(StrategicRegionMarker.GetStrategicRegion)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	alwaystransparent = no
	using = clickthrough_blocker
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	### BACKGROUND (HAS INTEREST)
	widget = {
		size = { 100% 100% }
		datacontext = "[StrategicRegionMarker.GetStrategicRegion]"
		visible = "[GetPlayer.HasInterestIn( StrategicRegion.Self )]"

		background = {
			using = paper_bg
		}
	}

	### BACKGROUND (NO INTEREST)
	widget = {
		size = { 100% 100% }
		datacontext = "[StrategicRegionMarker.GetStrategicRegion]"
		visible = "[Not(GetPlayer.HasInterestIn( StrategicRegion.Self ))]"

		background = {
			using = default_background
		}
	}

	### CONTENT
	flowcontainer = {
		direction = vertical
		margin = { 7 7 }
		spacing = 7

		textbox = {
			multiline = yes
			datacontext = "[StrategicRegionMarker.GetStrategicRegion]"
			raw_text = "#BOLD [StrategicRegion.GetNameNoFormatting]#!"
			autoresize = yes
			align = hcenter|nobaseline
			parentanchor = top|hcenter
			margin = { 25 0 }
			visible = "[IsZoomLevelNear]"
			using = fontsize_large

			tooltipwidget = {
				FancyTooltip_StrategicRegion = {}
			}
		}

		### NATIONS WITH INTEREST MARKERS
		dynamicgridbox = {
			parentanchor = hcenter
			flipdirection = yes
			name = "interest_marker_box"
			datamodel = "[StrategicRegionMarker.GetStrategicRegion.GetInterests]"
			datamodel_wrap = 8
			visible = "[Not(IsDataModelEmpty(StrategicRegionMarker.GetStrategicRegion.GetInterests))]"

			item = {
				container = {
					tooltip = "INTEREST_MARKER_TOOLTIP"
					using = tooltip_above
					datacontext = "[StrategicRegionMarker.GetStrategicRegion]"

					### ZOOMED OUT
					widget = {
						visible = "[Not(IsZoomLevelNear)]"
						size = { 35 33 }

						tiny_flag = {
							position = { 0 -2 }
							visible = "[Not(Interest.IsActive)]"
							datacontext = "[Interest.GetOwner]"
							blockoverride "tooltip" {}
							parentanchor = center
							alpha = 0.3
						}
						tiny_flag = {
							position = { 0 -2 }
							visible = "[Interest.IsActive]"
							datacontext = "[Interest.GetOwner]"
							blockoverride "tooltip" {}
							parentanchor = center
						}

						widget = {
							size = { 25 4 }
							position = { 0 12 }
							visible = "[Interest.ShouldShowProgressBar]"
							parentanchor = center

							bad_progressbar_horizontal = {
								visible = "[Interest.IsActive]"
								size = { 100% 100% }
								blockoverride "values" {
									min = 0
									max = 1
									value = "[Interest.GetProgress]"
								}
							}

							default_progressbar_horizontal = {
								visible = "[Not(Interest.IsActive)]"
								size = { 100% 100% }
								blockoverride "values" {
									min = 0
									max = 1
									value = "[Interest.GetProgress]"
								}
							}
						}
					}

					### ZOOMED IN
					widget = {
						size = { 65 52 }
						visible = "[IsZoomLevelNear]"

						small_flag = {
							position = { 0 -5 }
							visible = "[Not(Interest.IsActive)]"
							datacontext = "[Interest.GetOwner]"
							blockoverride "tooltip" {}
							parentanchor = center
							alpha = 0.5
						}
						small_flag = {
							position = { 0 -5 }
							visible = "[Interest.IsActive]"
							datacontext = "[Interest.GetOwner]"
							blockoverride "tooltip" {}
							parentanchor = center
						}

						widget = {
							size = { 46 6 }
							position = { 0 18 }
							visible = "[Interest.ShouldShowProgressBar]"
							parentanchor = center

							bad_progressbar_horizontal = {
								visible = "[Interest.IsActive]"
								size = { 100% 100% }
								blockoverride "values" {
									min = 0
									max = 1
									value = "[Interest.GetProgress]"
								}
							}

							default_progressbar_horizontal = {
								visible = "[Not(Interest.IsActive)]"
								size = { 100% 100% }
								blockoverride "values" {
									min = 0
									max = 1
									value = "[Interest.GetProgress]"
								}
							}
						}
					}
				}
			}
		}

		### DIPLO PLAY
		flowcontainer = {
			using = default_list_position
			visible = "[StrategicRegionMarker.GetStrategicRegion.HasDiplomaticPlay]"
			margin_top = 5

			diplomatic_play_item = {
				visible = "[Not(StrategicRegionMarker.GetStrategicRegion.GetFirstDiplomaticPlay.HasEscalatedIntoWar)]"
				datacontext = "[StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay]"
			}

			war_item = {
				visible = "[StrategicRegionMarker.GetStrategicRegion.GetFirstDiplomaticPlay.HasEscalatedIntoWar]"
				blockoverride "datacontext" {
					datacontext = "[StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay.AccessWar]"
				}
			}
		}
	}
}

### DIPLOMATIC PLAY
container = {
	name = "diplomatic_play_marker"
	ignoreinvisible = yes
	onmousehierarchyenter = "[AccessHighlightManager.HighlightStrategicRegion(StrategicRegionMarker.GetStrategicRegion)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	alwaystransparent = no
	using = clickthrough_blocker
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter
	datacontext = "[StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay]"

	button = {
		name = "diplo_play_item"
		onclick = "[InformationPanelBar.OpenDiplomaticPlayPanelTab( StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay, 'default' )]"
		onrightclick = "[RightClickMenuManager.ShowForDiplomaticPlay(DiplomaticPlay.AccessSelf)]"
		using = default_button
		tooltip = "DIPLOMATIC_PLAY_OUTLINER_TOOLTIP"

		icon = {
			size = { 100% 50% }

			background = {
				using = fade_center_colored
				color = "[DiplomaticPlay.GetInitiator.GetMapColor]"
				margin_bottom = 5
			}
		}

		icon = {
			parentanchor = bottom
			size = { 100% 50% }
			
			background = {
				using = fade_center_colored
				color = "[DiplomaticPlay.GetTarget.GetMapColor]"
				margin_top = 5
			}
		}

		### BOTTOM INFO
		flowcontainer = {
			datacontext = "[StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay]"
			resizeparent = yes
			margin = { 5 10 }

			### progressbar + small phase images
			container = {
				parentanchor = vcenter
				widget = {
					size = { 30 30 }
					parentanchor = center
					animated_progresspie = {
						tooltip = "DIPLOMATIC_PLAY_ESCALATION_TOOLTIP"
						texture = "gfx/interface/diplomatic_plays/escalation_progress.dds"
						size = { 70 70 }
						framesize = { 492 492 }
						frame = 2
						value = "[FixedPointToFloat(DiplomaticPlay.GetEscalationProgress)]"
						parentanchor = center
					}
					animated_progresspie = {
						tooltip = "DIPLOMATIC_PLAY_ESCALATION_TOOLTIP"
						texture = "gfx/interface/diplomatic_plays/escalation_progress.dds"
						size = { 70 70 }
						framesize = { 492 492 }
						frame = 2
						value = "[FixedPointToFloat(DiplomaticPlay.GetEscalationProgress)]"
						parentanchor = center
					}
					animated_progresspie = {
						tooltip = "DIPLOMATIC_PLAY_ESCALATION_TOOLTIP"
						texture = "gfx/interface/diplomatic_plays/escalation_progress.dds"
						size = { 70 70 }
						framesize = { 492 492 }
						frame = 2
						value = "[FixedPointToFloat(DiplomaticPlay.GetEscalationProgress)]"
						parentanchor = center
					}
					### phase images
					icon = {
						texture = "gfx/interface/diplomatic_plays/phase_opening_moves_small.dds"
						size = { 56 56 }
						parentanchor = center
						visible = "[LessThan_int32(DiplomaticPlay.GetEscalation, GetDefine('NDiplomacy', 'DIPLOMATIC_PLAY_OPENING_PHASE_END'))]"
					}
					icon = {
						texture = "gfx/interface/diplomatic_plays/phase_diplomatic_maneuvers_small.dds"
						size = { 56 56 }
						parentanchor = center
						visible = "[And(GreaterThanOrEqualTo_int32(DiplomaticPlay.GetEscalation, GetDefine('NDiplomacy', 'DIPLOMATIC_PLAY_OPENING_PHASE_END')),LessThan_int32(DiplomaticPlay.GetEscalation, GetDefine('NDiplomacy', 'DIPLOMATIC_PLAY_CLOSING_PHASE_START')))]"
					}
					icon = {
						texture = "gfx/interface/diplomatic_plays/phase_countdown_to_war_small.dds"
						size = { 56 56 }
						parentanchor = center
						visible = "[GreaterThanOrEqualTo_int32(DiplomaticPlay.GetEscalation, GetDefine('NDiplomacy', 'DIPLOMATIC_PLAY_CLOSING_PHASE_START'))]"
					}

					### frame on top
					icon = {
						tooltip = "DIPLOMATIC_PLAY_ESCALATION_TOOLTIP"
						texture = "gfx/interface/diplomatic_plays/escalation_progress_frame_small.dds"
						size = { 76 76 }
						parentanchor = center
					}
				}
			}

			widget = { size = { 30 30 }}

			### NATIONS INVOLVED
			flowcontainer = {
				direction = vertical
				spacing = 4
				parentanchor = vcenter

				### SUPPORTS
				flowcontainer = {
					spacing = 5

					overlappingitembox = {
						datamodel = "[DiplomaticPlay.AccessInitiatorSideCountriesNoLoyalSubjects]"
						maximumsize = { 225 20 }
						autoresize = yes

						item = {
							widget = {
								size = { 32 20 }

								tiny_flag_no_interact = {
									blockoverride "tooltip" {}
								}
							}
						}
					}
				}

				divider_clean = {}

				### OPPOSES
				flowcontainer = {
					spacing = 5

					overlappingitembox = {
						datamodel = "[DiplomaticPlay.AccessTargetSideCountriesNoLoyalSubjects]"
						maximumsize = { 225 20 }
						autoresize = yes

						item = {
							widget = {
								size = { 32 20 }

								tiny_flag_no_interact = {
									blockoverride "tooltip" {}
								}
							}
						}
					}
				}
			}
		}
	}
}

### WARS
container = {
	name = "war_marker"
	ignoreinvisible = yes
	onmousehierarchyenter = "[AccessHighlightManager.HighlightStrategicRegion(StrategicRegionMarker.GetStrategicRegion)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	alwaystransparent = no
	using = clickthrough_blocker
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter
	datacontext = "[StrategicRegionMarker.AccessStrategicRegion.AccessFirstDiplomaticPlay.AccessWar]"
			
	outliner_war_item = {}
}


### BUILDING PROGRESS (zoomed in)
container = {
	name = "construction_queue_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	ignoreinvisible = yes
	onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	container = {
		using = building_size_tooltip_with_ownership
		button = {
			datacontext = "[Building.GetState]"
			onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
			onrightclick = "[RightClickMenuManager.ShowForBuilding(Building.AccessSelf)]"
			onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
			onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
			using = default_button
			visible = "[And(Building.GetState.IsBeingHighlighted, IsZoomLevelNear)]"

			flowcontainer = {
				margin = { 6 2 }
				resizeparent = yes
				spacing = 3
				icon = {
					size = { 23 23 }
					texture = "[Building.GetIcon]"
				}

				textbox = {
					text = "BUILDING_SIZE"
					autoresize = yes
					parentanchor = vcenter
					align = nobaseline
					using = fontsize_small
					background = {
						using = blurry_dark_background
					}
				}
			}
		}
	}
}

container = {
	name = "construction_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	ignoreinvisible = yes
	onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	button = {
		parentanchor = hcenter
		visible = "[Building.IsCurrentlyUnderConstruction]"
		onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
		onrightclick = "[RightClickMenuManager.ShowForBuilding(Building.AccessSelf)]"
		onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		tooltip = "BUILDING_PROGRESS_TOOLTIP"

		flowcontainer = {
			alwaystransparent = yes
			resizeparent = yes
			direction =  vertical

			icon = {
				size = { 30 30 }
				texture = "[Building.GetIcon]"
				parentanchor = hcenter
				onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
			}
		}

		default_progressbar_horizontal = {
			size = { 24 2 }
			parentanchor = hcenter
			position = { 0 4 }

			blockoverride "values" {
				value = "[Building.GetConstructionProgressPercentage]"
				min = 0
				max = 1
			}
		}
	}
}

### CONSTRUCTION SUMMARY
container = {
	name = "construction_summary_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	datacontext = "[StateMarker.GetState.GetCountry]"
	parentanchor = bottom|hcenter

	tooltip = "STATE_CONSTRUCTION_QUEUE_TOOLTIP"

	flowcontainer = {
		resizeparent = yes

		background = {
			using = default_background
		}

		textbox = {
			raw_text = "@construction! [GetPlayer.GetNumBuildingsUnderConstructionInState(State.Self)|v]"
			autoresize = yes
			align = nobaseline
			margin = { 9 4 }
		}
	}
}

### INPUT GOODS SUMMARY
container = {
	name = "input_goods_shortage_summary_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	datacontext = "[StateMarker.GetState.GetCountry]"
	parentanchor = bottom|hcenter

	tooltip = "STATE_HAS_INPUT_SHORTAGES"

	button = {
		onclick = "[InformationPanelBar.OpenStatePanel(State.AccessSelf)]"
		size = { 30 30 }
		visible = "[And(IsZoomLevelMid, GreaterThan_int32(State.GetNumBuildingsAffectedByGoodsShortage, '(int32)1'))]"


		flowcontainer = {
			resizeparent = yes


			background = {
				using = default_background
			}

			textbox = {
				raw_text = "@goods_shortage![State.GetNumBuildingsAffectedByGoodsShortage|v]"
				autoresize = yes
				align = nobaseline
				parentanchor = vcenter
				margin = { 9 4 }
				margin_left = 6
			}
		}

	}
}

container = {
	name = "building_details_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	ignoreinvisible = yes
	parentanchor = bottom|hcenter

	tooltipwidget = {
		FancyTooltip_Building = {}
	}

	icon = {
		size = { 50 50 }
		texture = "[Building.GetIcon]"

		textbox = {
			minimumsize = { -1 22 }
			autoresize = yes
			margin_right = 5
			margin_left = 5
			align = left|nobaseline
			text = "[Building.GetExpansionLevelDesc]"
			using = fontsize_small

			background = {
				using = dark_area
			}
		}
	}
}

container = {
	name = "building_relationship_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	ignoreinvisible = yes
	parentanchor = bottom|hcenter

	tooltipwidget = {
		FancyTooltip_Building = {}
	}

	button = {
		size = { 26 26 }
		visible = "[Not(BuildingMarker.IsOpenInBuildingPanel)]"

		texture = "[Building.GetIcon]"
		onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
		onrightclick = "[RightClickMenuManager.ShowForBuilding( Building.AccessSelf )]"

		textbox = {
			autoresize = yes
			text = "[Building.GetExpansionLevel|v]"
			using = fontsize_small
			margin_left = 3
			margin_top = 1
			align = nobaseline
		}
	}

	button = {
		size = { 40 40 }
		visible = "[BuildingMarker.IsOpenInBuildingPanel]"

		texture = "[Building.GetIcon]"
		onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
		onrightclick = "[RightClickMenuManager.ShowForBuilding( Building.AccessSelf )]"

		textbox = {
			autoresize = yes
			text = "[Building.GetExpansionLevel|v]"
			using = fontsize_small
			margin_left = 2
			margin_top = 1
			align = nobaseline
		}
		icon = {
			size = { 45 45 }
			visible = "[BuildingMarker.IsOpenInBuildingPanel]"
			using = highlighted_square_selection
		}
	}

}


### INPUT SHORTAGE MARKERS
container = {
	name = "input_shortage_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter
	
	button = {
		tooltip = "GOODS_OUTPUT_PENALTY_TOOLTIP"
		visible = "[Or(IsZoomLevelNear, EqualTo_int32(Building.GetState.GetNumBuildingsAffectedByGoodsShortage, '(int32)1'))]"

		onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
		onrightclick = "[RightClickMenuManager.ShowForBuilding(Building.AccessSelf)]"
		
		size = { 45 23 }

		icon = {
			position = { 10 0 }
			size = { 23 23 }
			texture = "[Building.GetIcon]"
		}

		icon = {
			parentanchor = vcenter
			size = { 19 19 }
			texture = "gfx/interface/icons/generic_icons/goods_shortage.dds"
		}
	}
}

### EMPLOYMENT MARKERS
button = {
	name = "employment_marker"
	datacontext = "[BuildingMarker.AccessBuilding]"
	layer = layer_map_markers
	max_update_rate = 8
	tooltip = "TOOLTIP_BUILDING_HIRING"
	parentanchor = bottom|hcenter

	onclick = "[InformationPanelBar.OpenBuildingDetailsPanel(Building.AccessSelf)]"
	onrightclick = "[RightClickMenuManager.ShowForBuilding(Building.AccessSelf)]"

	onmousehierarchyenter = "[AccessHighlightManager.HighlightState(Building.GetState)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

	container = {
		resizeparent = yes
		flowcontainer = {
			visible = "[Not(Building.HasFailedHires)]"
			margin = { 5 5 }
			parentanchor = vcenter
			position = { 42 0 }
			container = {
				default_progressbar_horizontal = {
					size = { 40 4 }
					parentanchor = vcenter
					blockoverride "values" {
						value = "[FixedPointToFloat(Building.GetEmploymentPercentage)]"
						min = 0
						max = 1
					}
				}
			}
		}

		icon = {
			position = { 15 0 }
			size = { 30 30 }
			texture = "[Building.GetIcon]"
		}

		icon = {
			parentanchor = vcenter
			visible = "[Building.ShouldShowAsUnableToHire]"
			size = { 25 25 }
			texture = "gfx/interface/icons/generic_icons/employment_not_full.dds"
			tooltip = "NOT_HIRING"
		}

		employment_indicator_icon = {
			blockoverride "indicator_icon_size" {
				size = { 25 25 }
			}
		}	
	}
}

# CITIES
container = {
	name = "city_marker"
	datacontext = "[CityMarker]"
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	### regular cities
	container = {
		visible = "[Not(CityMarker.IsCountryCapital)]"

		background = {
			using = colored_panel_dark
			color = "[CityMarker.GetCountry.GetMapColor]"
			margin = { 6 0 }
			alpha = 0.7
		}

		textbox = {
			text = "[CityMarker.GetCityName]"
			align = nobaseline
			autoresize = yes
			parentanchor = center
			margin = { 0 1 }
			using = fontsize_small
		}
	}

	### capital cities
	flowcontainer = {
		visible = "[CityMarker.IsCountryCapital]"
		parentanchor = center
		spacing = 4
		margin = { 4 2 }
		margin_left = 2

		background = {
			using = colored_panel_dark
			alpha = 0.5
		}

		background = {
			using = colored_panel
			color = "[CityMarker.GetCountry.GetMapColor]"
			alpha = 0.5
		}

		icon = {
			texture = "gfx/interface/icons/state_status_icons/state_capital_icon.dds"
			size = { 14 14 }
			parentanchor = vcenter
		}
		textbox = {
			parentanchor = vcenter
			raw_text = "#bold [CityMarker.GetCityName]#!"
			align = nobaseline
			autoresize = yes
			font = "PlayfairDisplay"
			fontsize = 14
			default_format = "#v"
		}

		tiny_flag = {
			datacontext = "[CityMarker.GetCountry]"
			parentanchor = vcenter

			blockoverride "tiny_flag_size" {
				size = { 24 16 }
			}

			blockoverride "visibility" {
				visible = no
			}
		}
	}
}

### COLONY
container = {
	name = "colony_marker"
	using = small_nib
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	button = {
		datacontext = "[ColonyMarker.AccessState]"
		tooltip = "STATE_COLONY_TOOLTIP"
		size = { 97 26 }
		onclick = "[InformationPanelBar.OpenStatePanel(ColonyMarker.AccessState)]"
		using = default_button

		tiny_flag = {
			datacontext = "[State.GetOwner]"
			parentanchor = left|vcenter
		}

		default_progressbar_horizontal = {
			size = { 62 15 }
			position = { 31 0 }
			parentanchor = vcenter
			blockoverride "values" {
				value = "[State.GetColonyProgressAsFloat]"
				min = 0
				max = 1
			}
		}

		textbox = {
			visible = "[And( Not(State.IsColonyProgressBlockedByInactiveInterest), GreaterThan_int32( State.GetColonyProgressAsDays, '(int32)-1'))]"
			text = "COLONY_MAP_MARKER_DAYS_LEFT"
			autoresize = yes
			position = { -7 0 }
			parentanchor = right|vcenter
			widgetanchor = right|vcenter
			align = right|nobaseline
			using = fontsize_xsmall
		}

		textbox = {
			visible = "[Or(State.IsColonyProgressBlockedByInactiveInterest, Not(GreaterThan_int32( State.GetColonyProgressAsDays, '(int32)-1')))]"
			text = "NO_PROGRESS"
			autoresize = yes
			position = { -7 0 }
			parentanchor = right|vcenter
			widgetanchor = right|vcenter
			align = right|nobaseline
			using = fontsize_xsmall
		}
	}
}

### OBSTINANCE
container = {
	name = "obstinance_marker"
	datacontext = "[ObstinanceMarker.GetState]"
	using = clickthrough_blocker
	alwaystransparent = no
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter
	tooltip = "TOOLTIP_STATE_OBSTINANCE"

	widget = {
		visible = "[IsZoomLevelNear]"
		size = { 40 40 }
		allow_outside = yes

		flowcontainer = {
			margin = { 5 2 }
			margin_left = 15
			parentanchor = vcenter
			position = { 27 0 }
			allow_outside = yes
			using = clickthrough_blocker
			alwaystransparent = no

			background = {
				using = entry_bg_simple_solid
			}

			textbox = {
				parentanchor = vcenter
				autoresize = yes
				align = nobaseline
				raw_text = "STATE_OBSTINANCE_CONDENSED"
			}
		}

		button = {
			parentanchor = hcenter
			size = { 40 40 }
			onclick = "[InformationPanelBar.OpenStatePanel(State.AccessSelf)]"
			texture = "gfx/interface/icons/state_status_icons/state_obstinance.dds"
		}
	}

	widget = {
		visible = "[IsZoomLevelMid]"
		size = { 40 40 }
		allow_outside = yes

		flowcontainer = {
			margin = { 5 2 }
			margin_left = 15
			parentanchor = vcenter
			position = { 27 0 }
			using = clickthrough_blocker
			alwaystransparent = no

			background = {
				using = entry_bg_simple_solid
			}

			textbox = {
				parentanchor = vcenter
				autoresize = yes
				align = nobaseline
				raw_text = "#v [State.GetObstinance|%r1]#!"
			}
		}

		button = {
			parentanchor = hcenter
			size = { 40 40 }
			onclick = "[InformationPanelBar.OpenStatePanel(State.AccessSelf)]"
			texture = "gfx/interface/icons/state_status_icons/state_obstinance.dds"
		}
	}

	button = {
		visible = "[IsZoomLevelFar]"
		size = { 30 30 }
		onclick = "[InformationPanelBar.OpenStatePanel(State.AccessSelf)]"
		texture = "gfx/interface/icons/state_status_icons/state_obstinance.dds"
	}
}

### PRODUCTION STATE (small)
flowcontainer = {
	name = "production_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[ProductionMarker.AccessState]"
	direction = vertical
	margin_bottom = 5
	parentanchor = bottom|hcenter

	flowcontainer = {
		direction = vertical
		tooltip = "STATE_PRODUCTION_MARKER_TOOLTIP"
		visible = "[Or(IsZoomLevelNear, And(Not(IsZoomLevelNear), ObjectsEqual(State.AccessSelf, State.AccessStateRegion.GetLargestStateInRegion)))]"

		background = {
			visible = "[IsZoomLevelNear]"
			using = default_background
			margin = { 11 6 }
		}

		flowcontainer = {
			visible = "[Not(IsDataModelEmpty(State.AccessStateRegion.AccessTraits))]"
			datamodel = "[State.AccessStateRegion.AccessTraits]"
			datamodel_reuse_widgets = yes
			spacing = 2
			parentanchor = hcenter
			margin_top = 2

			item = {
				flowcontainer = {
					onmousehierarchyenter = "[AccessHighlightManager.HighlightStateTrait(StateTrait.Self)]"
					onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
					alwaystransparent = no
					tooltip = TOOLTIP_STATE_TRAIT

					icon = {
						visible = "[Not(IsZoomLevelFar)]"
						size = { 36 36 }
						texture = "[StateTrait.GetTexture]"
					}

					icon = {
						visible = "[IsZoomLevelFar]"
						size = { 25 25 }
						texture = "[StateTrait.GetTexture]"
					}
				}
			}
		}

		textbox = {
			visible = "[IsZoomLevelNear]"
			using = default_list_position
			text = "MAP_LIST_STATE_AVAILABLE_LABOR"
			tooltip = "STATE_AVAILABLE_LABOR_TOOLTIP"
			autoresize = yes
			align = left|nobaseline
		}
	}

	widget = {
		visible = "[IsZoomLevelNear]"
		size = { 3 3 }
	}
	
	widget = {
		visible = "[IsZoomLevelNear]"
		using = default_list_position
		using = small_nib
	}
}

### BATTLE
container = {
	name = "battle_marker"
	using = clickthrough_blocker
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter


	### ONGOING BATTLE
	container = {
		datacontext = "[BattleMarker.GetBattle]"
		visible = "[Or(Or(IsMapModeSelected( 'mm_military' ), IsMapModeSelected( 'mm_military_with_past_battles' )), Battle.IsRelevantForCountry( GetMetaPlayer.GetPlayedOrObservedCountry.Self ))]"

		onmousehierarchyenter = "[AccessHighlightManager.HighlightBattle(Battle.Self)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		alwaystransparent = no

		parentanchor = bottom|hcenter

		widget = {
			size = { 40 40 }
			parentanchor = bottom|hcenter

			icon = {
				size = { 50 50 }
				parentanchor = center
				visible = "[Battle.IsBeingHighlighted]"
				texture = "gfx/interface/map_markers/round_highlight.dds"
			}
		}

		button = {
			onclick = "[InformationPanelBar.OpenBattlePanel( BattleMarker.GetBattle.AccessSelf )]"
			size = { 100% 100% }
		}

		### BATTLE PROGRESSBAR
		widget = {
			parentanchor = bottom|hcenter
			size = { 100% 3 }
			
			battle_progressbar = {
				parentanchor = bottom|hcenter
				position = { 0 7 }
				visible = "[Not(Battle.HasEnded)]"
				size = { 90% 3 }
				
				blockoverride "values" {
					value = "[Battle.CalcPushOfWar]"
					min = -1
					max = 1
				}

				blockoverride "marker" {}
			}
		}

		### BATTLE INFO SMALLER VERSION
		widget = {
			visible = "[Or(And(IsZoomLevelNear, Not(Battle.IsBeingHighlighted)), And(IsZoomLevelMid, Battle.IsBeingHighlighted))]"
			size = { 0 40 }

			state = {
				name = _show
				size = { 110 40 }
				duration = 0.2
				alpha = 1
				using = Animation_Curve_Default
			}
			state = {
				name = _hide
				size = { 0 40 }
				duration = 0.2
				alpha = 0
				using = Animation_Curve_Default
			}

			### attackers
			icon = {
				datacontext = "[Battle.AccessAttackerBattleParticipant]"
				using = colored_panel
				color = "[BattleParticipant.GetCountry.GetMilitaryInterfaceColor]"
				alwaystransparent = yes
				size = { 50% 25 }
				parentanchor = left|vcenter

				textbox = {
					position = { -23 0 }
					raw_text = "[Battle.GetAttackerSide.GetNumUnits|0v]#!"
					autoresize = yes
					align = right|nobaseline
					parentanchor = right|vcenter
				}
			}

			### defenders
			icon = {
				datacontext = "[Battle.AccessDefenderBattleParticipant]"
				using = colored_panel
				color = "[BattleParticipant.GetCountry.GetMilitaryInterfaceColor]"
				alwaystransparent = yes
				size = { 50% 25 }
				parentanchor = right|vcenter

				textbox = {
					position = { 23 0 }
					raw_text = "[Battle.GetDefenderSide.GetNumUnits|0v]#!"
					autoresize = yes
					align = left|nobaseline
					parentanchor = left|vcenter
				}
			}
		}

		### BATTLE INFO LARGER VERSION
		widget = {
			visible = "[And(IsZoomLevelNear, Battle.IsBeingHighlighted)]"
			size = { 0 40 }

			state = {
				name = _show
				size = { 230 40 }
				duration = 0.2
				alpha = 1
				using = Animation_Curve_Default
			}
			state = {
				name = _hide
				size = { 0 40 }
				duration = 0.2
				alpha = 0
				using = Animation_Curve_Default
			}

			### attackers
			widget = {
				size = { 50% 100% }
				parentanchor = left|vcenter
				datacontext = "[Battle.AccessAttackerBattleParticipant]"

				icon = {
					parentanchor = left|vcenter
					using = colored_panel
					datacontext = "[BattleParticipant.GetCountry]"
					color = "[Country.GetMilitaryInterfaceColor]"
					alwaystransparent = yes
					size = { 95 30 }

					tiny_flag = {
						parentanchor = left|vcenter
						position = { 5 0 }

						blockoverride "onhover" {}
						using = tooltip_ws
					}

					textbox = {
						raw_text = "[Battle.GetAttackerSide.GetNumUnits|0v]#!"
						autoresize = yes
						align = right|nobaseline
						parentanchor = right|vcenter
						position = { -25 0 }
					}

					manpower_bar = {
						size = { 5 20 }
						position  = { -15 0 }
						parentanchor = right|vcenter

						blockoverride "manpower_values" {
							max = "[Battle.GetStartingAttackerManpower]"
							value = "[Battle.CalcCurrentAttackerManpower]"
						}

						blockoverride "manpower_tooltip" {
							tooltip = "BATTLE_MANPOWER_ATTACKER_TOOLTIP"
						}
					}

					white_progressbar_vertical = {
						size = { 5 20 }
						position  = { -5 0 }
						tooltip = "BATTLE_MORALE_TOOLTIP"
						parentanchor = right|vcenter

						blockoverride "values" {
							min = 0
							max = 1
							value = "[FixedPointToFloat( BattleParticipant.GetMorale )]"
						}
						blockoverride "color" {
							color = "[GetMoraleColorVec( BattleParticipant.GetMorale )]"
						}
					}
				}
			}

			### defenders
			widget = {
				size = { 50% 100% }
				parentanchor = right|vcenter
				datacontext = "[Battle.AccessDefenderBattleParticipant]"

				icon = {
					parentanchor = right|vcenter
					using = colored_panel
					datacontext = "[BattleParticipant.GetCountry]"
					color = "[Country.GetMilitaryInterfaceColor]"
					alwaystransparent = yes
					size = { 95 30 }

					tiny_flag = {
						parentanchor = right|vcenter
						position = { -5 0 }
						blockoverride "onhover" {}
					}

					textbox = {
						raw_text = "[Battle.GetDefenderSide.GetNumUnits|0v]#!"
						autoresize = yes
						align = left|nobaseline
						parentanchor = left|vcenter
						position = { 25 0 }
					}

					manpower_bar = {
						size = { 5 20 }
						position  = { 15 0 }
						parentanchor = vcenter

						blockoverride "manpower_values" {
							max = "[Battle.GetStartingDefenderManpower]"
							value = "[Battle.CalcCurrentDefenderManpower]"
						}

						blockoverride "manpower_tooltip" {
							tooltip = "BATTLE_MANPOWER_DEFENDER_TOOLTIP"
						}
					}

					white_progressbar_vertical = {
						size = { 5 20 }
						position  = { 5 0 }
						tooltip = "BATTLE_MORALE_TOOLTIP"
						parentanchor = vcenter

						blockoverride "values" {
							min = 0
							max = 1
							value = "[FixedPointToFloat( BattleParticipant.GetMorale )]"
						}
						blockoverride "color" {
							color = "[GetMoraleColorVec( BattleParticipant.GetMorale )]"
						}
					}
				}
			}
		}

		icon = {
			size = { 40 40 }
			texture = "[Battle.GetBattleIcon]"
			tooltip = "[Battle.GetStatusString]"
			using = tooltip_above
			parentanchor = bottom|hcenter
			visible = "[Or(Battle.IsBeingHighlighted, IsZoomLevelNear)]"

			textbox = {
				visible = "[ObjectsEqual(Battle.GetAttacker, GetPlayer.Self)]"
				raw_text = "@unit_offense!"
				parentanchor = top|hcenter
				autoresize = yes
				position = { 0 -24 }
			}

			textbox = {
				visible = "[ObjectsEqual(Battle.GetDefender, GetPlayer.Self)]"
				raw_text = "@unit_defense!"
				parentanchor = top|hcenter
				autoresize = yes
				position = { 0 -24 }
			}
		}

		icon = {
			size = { 30 30 }
			texture = "[Battle.GetBattleIcon]"
			tooltip = "[Battle.GetStatusString]"
			using = tooltip_above
			parentanchor = center
			visible = "[And(IsZoomLevelMid, Not(Battle.IsBeingHighlighted))]"
		}

		icon = {
			size = { 20 20 }
			texture = "[Battle.GetBattleIcon]"
			tooltip = "[Battle.GetStatusString]"
			using = tooltip_above
			parentanchor = center
			visible = "[And(IsZoomLevelFar, Not(Battle.IsBeingHighlighted))]"
		}
	}
}

### BATTLE
container = {
	name = "past_battle_marker"
	datacontext = "[PastBattleMarker.GetBattle]"
	using = clickthrough_blocker
	layer = layer_map_markers
	max_update_rate = 8
	onmousehierarchyenter = "[AccessHighlightManager.HighlightBattle(Battle.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	alwaystransparent = no
	parentanchor = bottom|hcenter

	### BATTLE RESULT
	widget = {
		size = { 40 30 }
		datacontext = "[Battle.GetWinner]"
		color = "[Country.GetMilitaryInterfaceColor]"
		onmousehierarchyenter = "[AccessHighlightManager.HighlightBattle(Battle.Self)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		parentanchor = bottom|hcenter
		visible = "[Battle.IsBeingHighlighted]"

		icon = {
			size = { 45 45 }
			parentanchor = center
			visible = "[Battle.IsBeingHighlighted]"
			texture = "gfx/interface/map_markers/round_highlight.dds"
		}

		icon = {
			size = { 35 35 }
			texture = "[Battle.GetBattleIcon]"
			tooltip = "[Battle.GetStatusString]"
			parentanchor = center
			alpha = 0.75
		}

		tiny_flag = {
			visible = "[Country.IsValid]"
			parentanchor = center
		}

		textbox = {
			visible = "[Not(Country.IsValid)]"
			raw_text = "?"
			align = hcenter|nobaseline
			size = { 100% 100% }
		}

		button = {
			size = { 100% 100% }
			tooltip = "[Battle.GetStatusString]"
			onclick = "[InformationPanelBar.OpenBattlePanel( PastBattleMarker.GetBattle.AccessSelf )]"
		}
	}
}

### MILITARY FORMATION MARKER
button = {
	name = "military_formation_marker"
	parentanchor = bottom|hcenter
	datacontext = "[FormationMarker.GetFirstMilitaryFormation]"
	onrightclick = "[RightClickMenuManager.ToggleMilitaryFormation(MilitaryFormation.AccessSelf, PdxGuiWidget.AccessSelf)]"

	onmousehierarchyenter = "[AccessHighlightManager.HighlightMilitaryFormation( MilitaryFormation.Self )]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

	layer = layer_map_markers
	max_update_rate = 8
	using = small_nib

	blockoverride "nib_visibility" {
		visible = "[FormationMarker.IsAnyFormationTraveling]"
	}
	
	click_modifiers = {
		ondefault = "[FormationMarker.OnLeftClick]"
		onshift = "[FormationMarker.OnShiftClick]"
		onctrl = "[FormationMarker.OnCtrlClick]"
	}

	is_mobilizing_progressbar = {
		visible = "[Not(FormationMarker.HasMultipleFormations)]"
		blockoverride "textbox" {}

		blockoverride "button_size" {
			size = { 100% 100% }
		}

		blockoverride "color" {
			color = "[MilitaryFormation.GetCountry.GetMilitaryInterfaceColor]"
		}
	}


	container = {
		resizeparent = yes
		
		background = {
			using = colored_panel
			color = "[MilitaryFormation.GetCountry.GetMilitaryInterfaceColor]"
			alpha = 0.8
		}
		
		widget = {
			visible = "[Not(FormationMarker.HasMultipleFormations)]"
			size = { 100% 100% }
			
			tooltipwidget = {
				FancyTooltip_MilitaryFormation_MapMarker = {}
			}
		}
		
		widget = {
			visible = "[FormationMarker.HasMultipleFormations]"
			size = { 100% 100% }
			tooltip = "[FormationMarker.GetSummaryTooltip]"
		}			

		# LARGE MARKER
		flowcontainer = {
			visible = "[Or( FormationMarker.IsAnyFormationHighlighted, MilitaryFormation.IsSelected)]"
			margin = { 1 1 }
			minimumsize = { 100 -1 }
			margin_left = 8

			flowcontainer = {
				margin_right = 5
				visible = "[MilitaryFormation.IsExiled]"
				parentanchor = vcenter
				
				icon = {
					size = { 32 32 }
					texture = "gfx/interface/icons/military_icons/exiled_state.dds"
					tooltip = "MILITARY_FORMATION_EXILED_ARMY_EFFECT_TOOLTIP"
				}
			}

			tiny_flag_no_interact = {
				parentanchor = vcenter
				datacontext = "[MilitaryFormation.GetCountry]"
			}

			flowcontainer = {
				visible = "[Not(FormationMarker.HasMultipleFormations)]"
				parentanchor = vcenter
				direction = vertical
				margin_right = 5

				icon = {
					visible = "[MilitaryFormation.IsArmy]"
					parentanchor = hcenter
					size = { 32 32 }
					color = "[MilitaryFormation.GetFlagColor]"
					texture = "[MilitaryFormation.GetFlag]"
				}

				icon = {
					visible = "[MilitaryFormation.IsFleet]"
					parentanchor = hcenter
					size = { 32 32 }
					color = "[MilitaryFormation.GetFlagColor]"
					texture = "[MilitaryFormation.GetFlag]"
				}

				textbox = {
					visible = "[MilitaryFormation.IsTraveling]"
					parentanchor = hcenter
					autoresize = yes
					align = hcenter|nobaseline
					using = fontsize_small
					text = "[MilitaryFormation.GetTravelTimeLeftLabel]"
				}
			}

			vertical_divider = {}

			flowcontainer = {
				direction = vertical
				parentanchor = vcenter
				spacing = 4
				margin = { 0 3 }
				margin_left = 10 

				flowcontainer = {
					parentanchor = hcenter
					spacing = 5

					icon = {
						visible = "[FormationMarker.IsArmy]"
						size = { 23 23 }
						texture = "gfx/interface/icons/generic_icons/battalions.dds"
						parentanchor = vcenter
					}

					icon = {
						visible = "[FormationMarker.IsFleet]"
						size = { 23 23 }
						texture = "gfx/interface/icons/generic_icons/flotillas.dds"
						parentanchor = vcenter
					}
					
					textbox = {
						text = "MARKER_COMBAT_UNITS_TYPE_AND_NUM"
						using = transparent_if_unmobilized_in_conflict
						autoresize = yes
						align = nobaseline
						parentanchor = vcenter
						margin_right = 5
					}

					flowcontainer = {
						visible = "[NotEqualTo_int64(FormationMarker.CalcCurrentManpower, FormationMarker.CalcMaxManpower)]"
						parentanchor = vcenter
						margin_right = 5

						manpower_bar = {
							size = { 6 30 }
							parentanchor = vcenter
							
							blockoverride "manpower_values" {
								max = "[FormationMarker.CalcMaxManpower]"
								value = "[FormationMarker.CalcCurrentManpower]"
							}

							blockoverride "manpower_tooltip" {}							
						}
					}

					flowcontainer = {
						parentanchor = vcenter
						direction = vertical

						textbox = {
							raw_text = "@unit_offense! [FormationMarker.CalcAverageAvailableOffense|0v]"
							autoresize = yes
							align = nobaseline
							using = fontsize_small
							minimumsize = { 40 -1 }
							margin_right = 3
						}

						textbox = {
							raw_text = "@unit_defense! [FormationMarker.CalcAverageAvailableDefense|0v]"
							autoresize = yes
							align = nobaseline
							using = fontsize_small
							minimumsize = { 40 -1 }
							margin_right = 3
						}
					}

					organization_bar = {
						visible = "[LessThan_CFixedPoint(FormationMarker.CalcAverageOrganizationPercentage, '(CFixedPoint)1')]"
						parentanchor = vcenter
						size = { 6 30 }
						
						blockoverride "organization_value" {
							value = "[FixedPointToFloat( FormationMarker.CalcAverageOrganizationPercentage )]"
						}

						blockoverride "organization_color" {
							color = "[GetOrganizationColorVec(FormationMarker.CalcAverageOrganizationPercentage )]"
						}
					}

					morale_bar = {
						visible = "[LessThan_CFixedPoint(FormationMarker.CalcAverageMorale, '(CFixedPoint)1')]"
						parentanchor = vcenter
						size = { 6 30 }
						
						blockoverride "morale_value" {
							value = "[FixedPointToFloat( FormationMarker.CalcAverageMorale )]"
						}

						blockoverride "morale_color" {
							color = "[GetMoraleColorVec( FormationMarker.CalcAverageMorale )]"
						}
					}
				}
			}
		}

		flowcontainer = {
			visible = "[And(Not(FormationMarker.IsAnyFormationHighlighted), Not(MilitaryFormation.IsSelected))]"

			flowcontainer = {
				visible = "[Not(IsZoomLevelFar)]"

				icon = {
					visible = "[MilitaryFormation.IsExiled]"
					parentanchor = vcenter
					size = { 25 25 }
					texture = "gfx/interface/icons/military_icons/exiled_state.dds"
					tooltip = "MILITARY_FORMATION_EXILED_ARMY_EFFECT_TOOLTIP"
				}

				icon = {
					visible = "[FormationMarker.IsArmy]"
					parentanchor = vcenter
					size = { 25 25 }
					color = "[MilitaryFormation.GetFlagColor]"
					texture = "[MilitaryFormation.GetFlag]"
				}

				icon = {
					visible = "[FormationMarker.IsFleet]"
					parentanchor = vcenter
					size = { 25 25 }
					color = "[MilitaryFormation.GetFlagColor]"
					texture = "[MilitaryFormation.GetFlag]"
				}
			}

			flowcontainer = {
				direction = vertical
				parentanchor = vcenter

				textbox = {
					visible = "[Not(IsZoomLevelFar)]"
					using = transparent_if_unmobilized_in_conflict
					autoresize = yes
					align = nobaseline
					margin_right = 5
					text = "MARKER_COMBAT_UNITS_TYPE_AND_NUM"
				}


				textbox = {
					visible = "[IsZoomLevelFar]"
					minimumsize = { 36 -1 }
					using = transparent_if_unmobilized_in_conflict
					autoresize = yes
					align = hcenter|nobaseline
					using = fontsize_small
					margin = { 4 2 }
					text = "MARKER_COMBAT_UNITS_TYPE_AND_NUM_WITH_ICON"
				}
			}
		}	
	}

	icon = {
		visible = "[Or(FormationMarker.IsAnyFormationHighlighted, MilitaryFormation.IsSelected)]"
		using = highlighted_square_selection
	}
}

### FRONT MARKER
container = {
	name = "front_marker"
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter
	datacontext = "[FrontMarker.GetFront]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightFront(Front.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

	container = {
		parentanchor = bottom|hcenter

		### FRONT INDICATOR - LARGE
		front_marker_icon = {
			visible = "[Or(IsZoomLevelNear, Front.IsBeingHighlighted)]"
		}

		### FRONT INDICATOR - MEDIUM
		front_marker_icon = {
			visible = "[And(IsZoomLevelMid, Not(Front.IsBeingHighlighted))]"

			blockoverride "icon_size" {
				size = { 45 45 }
			}

			blockoverride "fontsize" {
				using = fontsize_small
			}
		}

		### FRONT INDICATOR - SMALL
		front_marker_icon = {
			visible = "[And(IsZoomLevelFar, Not(Front.IsBeingHighlighted))]"

			blockoverride "icon_size" {
				size = { 30 30 }
			}

			blockoverride "fontsize" {
				using = fontsize_small
			}
		}
	}

	button = {
		visible = "[Or(IsZoomLevelNear, Front.IsBeingHighlighted)]"
		tooltip = "FRONT_MARKER_TOOLTIP"
		onclick = "[FrontMarker.OnClick]"
		parentanchor = bottom|hcenter
		size = { 70 70 }
	}

	button = {
		visible = "[And(IsZoomLevelMid, Not(Front.IsBeingHighlighted))]"
		tooltip = "FRONT_MARKER_TOOLTIP"
		onclick = "[FrontMarker.OnClick]"
		parentanchor = bottom|hcenter
		size = { 45 45 }
	}

	button = {
		visible = "[And(IsZoomLevelFar, Not(Front.IsBeingHighlighted))]"
		tooltip = "FRONT_MARKER_TOOLTIP"
		onclick = "[FrontMarker.OnClick]"
		parentanchor = bottom|hcenter
		size = { 30 30 }
	}
}

### FRONT MOVEMENT MARKER
container = {
	name = "front_movement_marker"
	layer = layer_map_markers
	allow_outside = yes
	max_update_rate = 8
	datacontext = "[FrontMovementMarker.GetFront]"
	using = clickthrough_blocker
	onmousehierarchyenter = "[SetCanOpenRightClickContextMenu( '(bool)no' )]"
	onmousehierarchyleave = "[SetCanOpenRightClickContextMenu( '(bool)yes' )]"

	container = {
		parentanchor = bottom|hcenter

		movement_marker_hover_vfx = {
			visible = "[And(Front.IsBeingHighlighted, FrontMovementMarker.CanDeploySelectedFormationsToFront)]"

			blockoverride "vfx_entity_instance" {
				entity_instance = vfx_entity_ui_onhover_front_formation_movement
				
			}
		}

		movement_marker_click_vfx = {
			blockoverride "vfx_entity_instance" {
				entity_instance = vfx_entity_ui_onclick_front_formation_movement
			}
		}

		### FRONT INDICATOR - LARGE
		front_movement_marker_icon = {
			visible = "[Or(Or(IsZoomLevelNear, Front.IsBeingHighlighted), FrontMovementMarker.IsAnySelectedFormationsTarget)]"
		}

		### FRONT INDICATOR - MEDIUM
		front_movement_marker_icon = {
			visible = "[And(And(IsZoomLevelMid, Not(Front.IsBeingHighlighted)), Not(FrontMovementMarker.IsAnySelectedFormationsTarget))]"

			blockoverride "icon_size" {
				size = { 45 45 }
			}
		}

		### FRONT INDICATOR - SMALL
		front_movement_marker_icon = {
			visible = "[And(And(IsZoomLevelFar, Not(Front.IsBeingHighlighted)), Not(FrontMovementMarker.IsAnySelectedFormationsTarget))]"

			blockoverride "icon_size" {
				size = { 30 30 }
			}

			blockoverride "fontsize" {
				using = fontsize_small
			}
		}
	}

	button = {
		visible = "[Not(FrontMovementMarker.CanDeploySelectedFormationsToFront)]"
		parentanchor = bottom|hcenter
		onmousehierarchyenter = "[AccessHighlightManager.HighlightFront(Front.Self)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		size = { 70 70 }
		tooltip = "FRONT_MOVEMENT_MARKER_TOOLTIP"
		onclick = "[InformationPanelBar.OpenFrontPanel(FrontMovementMarker.GetFront.Self)]"
	}

	button = {
		visible = "[FrontMovementMarker.CanDeploySelectedFormationsToFront]"
		parentanchor = bottom|hcenter
		onmousehierarchyenter = "[AccessHighlightManager.HighlightFront(Front.Self)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		size = { 70 70 }
		tooltip = "FRONT_MOVEMENT_MARKER_TOOLTIP"
		onclick = "[InformationPanelBar.OpenFrontPanel(FrontMovementMarker.GetFront.Self)]"
		onrightclick = "[Execute( Front.GetDeploySelectedFormationsCommand )]"
		onrightclick = "[PdxGuiWidget.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
		rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_front"
	}
}

### POLITICAL LOBBIES
flowcontainer = {
	name = "lobby_marker"
	datacontext = "[PoliticalLobbyMarker.GetPoliticalLobby]"
	direction = vertical
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	tooltipwidget = {
		FancyTooltip_PoliticalLobby = {}
	}

	widget = {
		size = {0 6} # a bit more room above since the lobby icon goes a bit "out of bounds"
	}


	### ZOOMED IN
	button = {
		size = { 54 30 }
		onclick = "[InformationPanelBar.OpenPoliticalLobbyPanel(PoliticalLobby.AccessSelf)]"
		button = {
			alwaystransparent = yes
			visible = "[EqualTo_string(PoliticalLobby.GetType.GetCategory,'foreign_pro_country')]"
			size = { 100% 100% }
			using = colored_panel
			color = { 0.11 0.46 0.05 1 }
		}

		button = {
			alwaystransparent = yes
			visible = "[EqualTo_string(PoliticalLobby.GetType.GetCategory,'foreign_anti_country')]"
			size = { 100% 100% }
			using = colored_panel
			color = { 0.5 0.04 0.02 1 }
		}

		tiny_flag_no_interact = {
			name = "target_country_flag"
			parentanchor = vcenter|right
			position = { -8 0 }
			datacontext = "[PoliticalLobby.GetTargetCountry]"

			blockoverride "tooltip" {} #no tooltip
		}

		icon = {
			name = "type_icon"
			parentanchor = vcenter|left
			size = { 32 32 }
			position = { -12 0 }
			texture = "[PoliticalLobby.GetType.GetTexture]"
		}
	}
}

### INTEREST GROUPS
flowcontainer = {
	name = "interestgroup_marker"
	datacontext = "[InterestGroupMarker.AccessInterestGroup]"
	righttoleft = yes
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	tooltipwidget = {
		FancyTooltip_IG = {}
	}

	### ZOOMED IN
	container = {
		visible = "[IsZoomLevelNear]"

		button = {
			visible = "[InterestGroup.IsPowerful]"
			onclick = "[InformationPanelBar.OpenInterestGroupPanel(InterestGroup.AccessSelf)]"
			onrightclick = "[RightClickMenuManager.ShowForIG(InterestGroup.AccessSelf)]"
			using = default_button
			size = { 100 38 }

			hbox = {
				margin_left = 3

				ig_icon = {
					size = { 30 30 }
				}

				textbox = {
					layoutpolicy_horizontal = expanding
					size = { 0 30 }
					raw_text = "#bold [InterestGroup.GetClout|%1]#!"
					margin = { 5 0 }
					align = left|nobaseline
					using = fontsize_large
				}
			}
		}
		button = {
			visible = "[Not(InterestGroup.IsPowerful)]"
			onclick = "[InformationPanelBar.OpenInterestGroupPanel(InterestGroup.AccessSelf)]"
			onrightclick = "[RightClickMenuManager.ShowForIG(InterestGroup.AccessSelf)]"
			using = default_button
			size = { 100 28 }

			hbox = {
				margin_left = 3

				widget = {
					size = { 30 25 }
					ig_icon = {
						size = { 25 25 }
						parentanchor = center
					}
				}

				textbox = {
					layoutpolicy_horizontal = expanding
					size = { 0 25 }
					raw_text = "#bold [InterestGroup.GetClout|%1]#!"
					margin = { 5 0 }
					align = left|nobaseline
				}
			}
		}
	}

	### ZOOMED OUT
	container = {
		visible = "[Not(IsZoomLevelNear)]"

		ig_button = {
			visible = "[InterestGroup.IsPowerful]"
			size = { 38 38 }
		}
		ig_button = {
			visible = "[Not(InterestGroup.IsPowerful)]"
			size = { 28 28 }
		}
	}
}

### REVOLUTIONARY MOVEMENT
container = {
	name = "revolutionary_movement_marker"
	datacontext = "[RevolutionaryMovementMarker.GetPoliticalMovement]"
	using = clickthrough_blocker
	alwaystransparent = no
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	onmousehierarchyenter = "[AccessHighlightManager.HighlightPoliticalMovement(PoliticalMovement.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"


	tooltipwidget = {
		FancyTooltip_PoliticalMovement = {}
	}

	### REVOLUTION VFX 
	widget = {
		size = { 70 70 }
		parentanchor = hcenter

		vfx = {
			blockoverride "position" {
				position = { 2 6 }
			}

			blockoverride "camera_position" {
				camera_position = { 0 0 -4 }
			}

			blockoverride "parent_anchor" {
				parentanchor = center
			}

			blockoverride "size" {
				size = { 350% 350% }
			}

			blockoverride "entity_instance"{
				entity_instance = vfx_entity_ui_revolution_map_marker
			}
		}
	}

	### MOVEMENT HIGHLIGHTED
	widget = {
		visible = "[PoliticalMovement.IsBeingHighlighted]"
		size = { 0 40 }
		parentanchor = vcenter

		state = {
			name = _show
			size = { 150 40 }
			position_x = 80
			duration = 0.2
			alpha = 1
			using = Animation_Curve_Default
		}
		state = {
			name = _hide
			size = { 0 40 }
			position_x = 40
			duration = 0.2
			alpha = 0
			using = Animation_Curve_Default
		}

		widget = {
			size = { 80% 100% }
			parentanchor = right|vcenter

			bad_progressbar_horizontal = {
				parentanchor = right|vcenter
				datacontext = "[PoliticalMovement.GetCivilWar]"
				size = { 80% 100% }

				blockoverride "values" {
					value = "[FixedPointToFloat( PoliticalMovement.GetCivilWar.GetProgress )]"
					min = 0
					max = 1
				}

				blockoverride "inbetween_progress_and_frame" {
					icon = {
						visible = "[GreaterThanOrEqualTo_CFixedPoint(PoliticalMovement.GetTargetRadicalism, '(CFixedPoint)1')]"
						size = { 100% 100% }
						using = look_at_me_animation_weak
						texture = "gfx/interface/progressbar/progressbar_bad_glow.dds"
					}
				}

				blockoverride "in_government_icon" {}
			}

			textbox = {
				parentanchor = right|vcenter
				align = right|nobaseline
				autoresize = yes
				raw_text = "#v [PoliticalMovement.GetCivilWar.GetProgress|0%]#!"
				position = { -40 0 }
			}

			icon = {
				parentanchor = right|vcenter
				size = { 30 30 }
				texture = "gfx/interface/icons/politics_icons/radicalized.dds"
				position = { -5 0 }
			}
		}
	}

	widget = {
		size = { 70 70 }
		parentanchor = hcenter

		round_progress_bad = {
			parentanchor = center
			size = { 100% 100% }
			value = "[FixedPointToFloat(PoliticalMovement.GetCivilWar.GetClockTime)]"
		}

		button_icon_round = {
			parentanchor = center
			size = { 70% 70% }
			onclick = "[InformationPanelBar.OpenPoliticalMovementPanel(PoliticalMovement.AccessSelf)]"
			onrightclick = "[RightClickMenuManager.ShowForPoliticalMovement(PoliticalMovement.AccessSelf)]"

			blockoverride "icon" {
				texture = "[PoliticalMovement.GetTexture]"
			}

			blockoverride "icon_size" {
				size = { 75% 75% }
			}
		}

		icon = {
			size = { 80 80 }
			parentanchor = center
			texture = "gfx/interface/map_markers/revolutionary_movement_frame.dds"
		}

	}
}

### NATIONAL AWAKENING
container = {
	name = "national_awakening_marker"
	datacontext = "[NationalAwakeningMarker.GetCulture]"
	using = clickthrough_blocker
	alwaystransparent = no
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter


	button_icon_round = {
		using = small_nib
		size = { 40 40 }
		onclick = "[InformationPanelBar.OpenCultureInfoPanel(Culture.AccessSelf)]"
		
		tooltipwidget = {
			FancyTooltip_Culture = {}
		}

		blockoverride "icon" {
			texture = "gfx/interface/icons/generic_icons/national_awakening.dds"
		}

		blockoverride "icon_size" {
			size = { 75% 75% }
		}
	}
}

### NATIONAL FOCUS
flowcontainer = {
	name = "decree_marker"
	datacontext = "[DecreeMarker.AccessDecree]"
	righttoleft = yes
	ignoreinvisible = yes
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	button = {
		using = small_nib
		size = { 48 48 }
		tooltip = "[Decree.GetTooltip]"
		onrightclick = "[RightClickMenuManager.ShowForDecree(Decree.AccessSelf)]"

		icon = {
			size = { 100% 100% }
			texture = "[Decree.GetTexture]"
		}
	}
}


### HOMELAND
flowcontainer = {
	name = "homeland_marker"
	datacontext = "[HomelandMarker.GetState]"
	layer = layer_map_markers
	max_update_rate = 8
	parentanchor = bottom|hcenter

	tiny_flag = {
		datacontext = "[State.GetOwner]"

		blockoverride "tooltip" {
			tooltip = "HOMELAND_MAP_MARKER_TOOLTIP"
		}
	}
}

### BUILDING POTENTIAL
container = {
	name = "building_potential_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[BuildingPotentialMarker.AccessState]"
	datacontext = "[State.GetBuilding( BuildingPotentialMarker.GetBuildingType.GetKey )]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightState(State.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	flowcontainer = {
		visible = "[MapInteractions.HasAnyActiveMapInteraction]"
		
		background = {
			using = text_edit_bg
		}

		background = {
			using = text_edit_bg
		}

		textbox = {
			visible = "[GetPlayer.HasForeignInvestmentRights(State.GetOwner)]"
			datacontext = "[State.GetBuilding( BuildingPotentialMarker.GetBuildingType.GetKey)]"
			text = "BUILDING_SIZE"
			using = building_size_tooltip_with_ownership
			autoresize = yes
			align = nobaseline
			margin_left = 6
			margin_right = 6
		}

		container = {
			visible = "[Not(BuildingPotentialMarker.GetBuildingType.IsUrban)]"
			container = {
				visible = "[Not(GetPlayer.HasForeignInvestmentRights(State.GetOwner))]"
				tooltip = "POTENTIAL_MAP_MARKER_TOOLTIP"
				onmousehierarchyenter = "[AccessHighlightManager.HighlightBuilding(Building.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
				alwaystransparent = no

				icon = {
					size = { 20 20 }
					visible = "[Not(IsZoomLevelNear)]"
					texture = "[BuildingPotentialMarker.GetBuildingType.GetIcon]"
				}

				icon = {
					size = { 30 30 }
					visible = "[IsZoomLevelNear]"
					texture = "[BuildingPotentialMarker.GetBuildingType.GetIcon]"
				}
			}
		}
	}
}

### HARVEST CONDITION REGION
container = {
	name = "harvest_condition_region_marker"
	layer = layer_map_markers
	parentanchor = bottom|hcenter
	max_update_rate = 8

	container = {
		using = small_nib

		blockoverride "nib_visibility" {
			visible = "[Or(IsZoomLevelNear, And(Not(IsZoomLevelNear), Not(Or(IsMapModeSelected('mm_default'), IsMapModeSelected('mm_ongoing_diplo_play')))))]"
		}
		
		flowcontainer = {
			datamodel = "[HarvestConditionRegionMarker.GetHarvestConditionAreas]"
			spacing = 5
			wrap_count = 4

			item = {
				container = {
					alwaystransparent = no	# For highlighting
					onmousehierarchyenter = "[AccessHighlightManager.HighlightHarvestConditionArea(HarvestConditionArea.Self)]"
					onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

					button = {
						visible = "[IsZoomLevelNear]"
						size = { 36 36 }
						texture = "[HarvestConditionArea.GetType.GetIcon]"
						onclick = "[InformationPanelBar.OpenMarketPanelTab(AccessPlayer.AccessFirstMarket.Self, 'food_security')]"

						tooltipwidget = {
							FancyTooltip_HarvestConditionArea = {}
						}
					}

					button = {
						visible = "[And(IsZoomLevelMid, Not(Or(IsMapModeSelected('mm_default'), IsMapModeSelected('mm_ongoing_diplo_play'))))]"
						size = { 30 30 }
						texture = "[HarvestConditionArea.GetType.GetIcon]"
						onclick = "[InformationPanelBar.OpenMarketPanelTab(AccessPlayer.AccessFirstMarket.Self, 'food_security')]"

						tooltipwidget = {
							FancyTooltip_HarvestConditionArea = {}
						}
					}

					button = {
						visible = "[And(IsZoomLevelFar, Not(Or(IsMapModeSelected('mm_default'), IsMapModeSelected('mm_ongoing_diplo_play'))))]"
						size = { 25 25 }
						texture = "[HarvestConditionArea.GetType.GetIcon]"
						onclick = "[InformationPanelBar.OpenMarketPanelTab(AccessPlayer.AccessFirstMarket.Self, 'food_security')]"

						tooltipwidget = {
							FancyTooltip_HarvestConditionArea = {}
						}
					}
				}
			}
		}
	}
}

### FAMINES MARKER
button = {
	name = "famine_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	using = small_nib
	parentanchor = bottom|hcenter

	background = {
		using = default_background
	}

	flowcontainer = {
		resizeparent = yes

		icon = {
			visible = "[State.HasFamine]"
			texture = "gfx/interface/backgrounds/round_button_bg.dds"
			size = { 35 35 }
			tooltip = "[State.GetFamineDesc]"

			icon = {
				size = { 35 35 }
				parentanchor = center
				texture = "gfx/interface/icons/famine_icons/famine_icon.dds"
			}
		}
	}
}

### HQ MARKER
container = {
	name = "hq_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[HQMarker.GetHQ]"
	datacontext = "[Hq.GetCountry]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightHQ(Hq.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter
	using = clickthrough_blocker

	container = {
		visible = "[Or(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self), Hq.IsBeingHighlighted)]"
		
		using = small_nib
		blockoverride "nib_visibility" {
			visible = "[IsZoomLevelNear]"
		}

		button = {
			visible = "[And(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self), Hq.IsLandHQ)]"
			tooltip = "HQ_MAP_MARKER_TOOLTIP"
			size = { 100% 100% }
			onclick = "[InformationPanelBar.OpenMilitaryPanelTab('army')]"
		}

		button = {
			visible = "[And(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self), Hq.IsNavalHQ)]"
			tooltip = "HQ_MAP_MARKER_TOOLTIP"
			size = { 100% 100% }
			onclick = "[InformationPanelBar.OpenMilitaryPanelTab('navy')]"
		}

		button = {
			visible = "[Not(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self))]"
			tooltip = "HQ_MAP_MARKER_TOOLTIP"
			size = { 100% 100% }
			onclick = "[InformationPanelBar.OpenCountryPanelTab(Country.Self, 'default')]"
		}

		background = {
			using = colored_panel_dark
			color = "[Country.GetMilitaryInterfaceColor]"
			alpha = 0.8
		}

		flowcontainer = {
			direction = vertical

			container = {
				visible = "[GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self)]"
				
				textbox = {
					text = "[Hq.GetCombatUnitsIcon] [Hq.GetNameNoFlagNoConcept]"
					autoresize = yes
					align = hcenter|nobaseline
					alwaystransparent = yes
					using = fontsize_small
					margin = { 6 1 }
					parentanchor = hcenter
					visible = "[IsZoomLevelMid]"
				}
				
				textbox = {
					text = "[Hq.GetCombatUnitsIcon] [Hq.GetName]"
					visible = "[IsZoomLevelNear]"
					autoresize = yes
					align = hcenter|nobaseline
					alwaystransparent = yes
					using = fontsize_small
					margin = { 5 3 }
					parentanchor = hcenter
				}
			}

			tiny_flag = {
				visible = "[Not(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self))]"

				blockoverride "tooltip" {
					tooltip = "[Hq.GetName]"
				}
			}
		}

		icon = {
			visible = "[Hq.IsBeingHighlighted]"
			using = highlighted_square_selection
		}
	}
}

### HQ MOVEMENT MARKER
button = {
	name = "hq_movement_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[HQMovementMarker.GetHQ]"
	datacontext = "[Hq.GetCountry]"
	using = clickthrough_blocker
	onmousehierarchyenter = "[SetCanOpenRightClickContextMenu( '(bool)no' )]"
	onmousehierarchyleave = "[SetCanOpenRightClickContextMenu( '(bool)yes' )]"

	container = {
		resizeparent = yes

		### ENEMY HQs DURING WARS
		container = {
			visible = "[And(Not(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self)), Not(Country.IsAlliedInDiploPlayWith(GetPlayer)))]"
			tooltip = "HQ_MOVEMENT_MARKER_NON_PLAYER_COUNTRY_TOOLTIP"

			background = {
				using = colored_panel_dark
				color = "[Hq.GetCountry.GetMilitaryInterfaceColor]"
				alpha = 0.5
			}

			textbox = {
				parentanchor = hcenter
				autoresize = yes
				align = hcenter|nobaseline
				using = fontsize_small
				margin = { 3 2 }
				text = "[Hq.GetName]"
			}
		}

		### PLAYER OR ALLIED HQs
		container = {
			visible = "[Or(GetMetaPlayer.IsPlayedOrObservedCountry(Country.Self), Country.IsAlliedInDiploPlayWith(GetPlayer.Self))]"
			tooltip = "HQ_MOVEMENT_MARKER_TOOLTIP"

			movement_marker_hover_vfx = {
				visible = "[Hq.IsBeingHighlighted]"

				blockoverride "vfx_entity_instance" {
					entity_instance = vfx_entity_ui_onhover_hq_formation_movement
				}
			}

			movement_marker_click_vfx = {
				blockoverride "vfx_entity_instance" {
					entity_instance = vfx_entity_ui_onclick_hq_formation_movement
				}
			}

			container = {
				visible = "[Not(Or(HQMovementMarker.IsAllSelectedFormationsLocation, HQMovementMarker.IsAllSelectedFormationsTarget))]"
				onmousehierarchyenter = "[AccessHighlightManager.HighlightHQ(Hq.Self)]"
				onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
			
				button = {
					enabled = "[HQMovementMarker.CanStationSelectedFormationsInHQ]"
					size = { 100% 100% }
					onrightclick = "[Execute( Hq.GetStationSelectedFormationsCommand )]"
					onrightclick = "[PdxGuiWidget.AccessParent.AccessParent.FindChild('onrightclick_vfx').TriggerAnimation('show')]"
					rightclicksound = "event:/SFX/UI/Military/formation_actions_station_at_hq"
					using = default_button
				}

				textbox = {
					parentanchor = hcenter
					autoresize = yes
					align = hcenter|nobaseline
					using = fontsize_small
					margin = { 7 5 }
					text = "[Hq.GetName]"
				}

				icon = {
					visible = "[Hq.IsBeingHighlighted]"
					using = highlighted_square_selection
				}
			}

			container = {
				visible = "[Or(HQMovementMarker.IsAllSelectedFormationsLocation, HQMovementMarker.IsAllSelectedFormationsTarget)]"

				background = {
					using = paper_bg
				}

				textbox = {
					parentanchor = hcenter
					autoresize = yes
					align = hcenter|nobaseline
					using = fontsize_small
					margin = { 7 5 }
					text = "[Hq.GetName]"
				}

				icon = {
					using = highlighted_active_square_selection
				}
			}
		}
	}
}

### INVASION MARKER
container = {
	name = "invasion_marker"
	datacontext = "[InvasionMarker.GetInvasion]"
	layer = layer_map_markers
	max_update_rate = 8
	onmousehierarchyenter = "[AccessHighlightManager.HighlightInvasion(Invasion.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter
	using = clickthrough_blocker

	container = {
		visible = "[Or(And(Not(Invasion.HasEnded), Invasion.IsRelevantForCountry( GetMetaPlayer.GetPlayedOrObservedCountry.Self )), Invasion.IsBeingHighlighted)]"
		
		onmousehierarchyenter = "[AccessHighlightManager.HighlightInvasion(Invasion.Self)]"
		onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
		onmousehierarchyenter = "[GetVariableSystem.Set(Concatenate('placeholder_naval_invasion_highlight_', Invasion.GetName), 'true')]"
		onmousehierarchyleave = "[GetVariableSystem.Set(Concatenate('placeholder_naval_invasion_highlight_', Invasion.GetName), 'false')]"

		alwaystransparent = no
		parentanchor = bottom|hcenter

		tooltip = "INVASION_MARKER_TOOLTIP"
		using = tooltip_above

		widget = {
			size = { 40 40 }
			parentanchor = bottom|hcenter

			icon = {
				size = { 50 50 }
				parentanchor = center
				visible = "[Invasion.IsBeingHighlighted]"
				texture = "gfx/interface/map_markers/round_highlight.dds"
			}
		}

		button = {
			visible = "[Not(InvasionMarker.CanDeploySelectedFormationsToDefend)]"
			onclick = "[InformationPanelBar.OpenInvasionPanel(Invasion.Self)]"
			size = { 100% 100% }
		}

		button = {
			visible = "[InvasionMarker.CanDeploySelectedFormationsToDefend]"
			onclick = "[InformationPanelBar.OpenInvasionPanel(Invasion.Self)]"
			onrightclick = "[Execute( Invasion.GetDeploySelectedFormationsCommand )]"
			rightclicksound = "event:/SFX/UI/Military/formation_actions_deploy_to_front"
			size = { 100% 100% }
		}

		### MEDIUM SIZE WITH FLAGS ONLY
		widget = {
			visible = "[And(IsZoomLevelNear, Not(Invasion.IsBeingHighlighted))]"
			size = { 0 60 }

			state = {
				name = _show
				size = { 110 60 }
				duration = 0.2
				alpha = 1
				using = Animation_Curve_Default
			}
			state = {
				name = _hide
				size = { 0 60 }
				duration = 0.2
				alpha = 0
				using = Animation_Curve_Default
			}

			### INVADER
			icon = {
				using = colored_panel
				color = "[Invasion.GetInvaderCountry.GetMilitaryInterfaceColor]"
				alwaystransparent = yes
				size = { 50% 25 }
				parentanchor = left|bottom
				position = { 0 -14 }

				tiny_flag_no_interact = {
					datacontext = "[Invasion.GetInvaderCountry]"
					parentanchor = right|vcenter
					position = { -23 0 }
				}

			}

			### TARGET
			icon = {
				using = colored_panel
				color = "[Invasion.GetInvadedCountry.GetMilitaryInterfaceColor]"
				alwaystransparent = yes
				size = { 50% 25 }
				parentanchor = right|bottom
				position = { 0 -14 }

				tiny_flag_no_interact = {
					datacontext = "[Invasion.GetInvadedCountry]"
					parentanchor = vcenter
					position = { 23 0 }
				}
			}
		}

		### INVASION HIGHLIGHTED - BIG SIZE WITH UNIT NUMBERS + FLAGS
		widget = {
			visible = "[Invasion.IsBeingHighlighted]"
			size = { 0 60 }

			state = {
				name = _show
				size = { 230 60 }
				duration = 0.2
				alpha = 1
				using = Animation_Curve_Default
			}
			state = {
				name = _hide
				size = { 0 60 }
				duration = 0.2
				alpha = 0
				using = Animation_Curve_Default
			}

			### INVADER
			widget = {
				size = { 50% 100% }
				parentanchor = left|vcenter
				position = { -10 0 }

				icon = {
					parentanchor = left|vcenter
					using = colored_panel
					color = "[Invasion.GetInvaderCountry.GetMilitaryInterfaceColor]"
					alwaystransparent = yes
					size = { 120 50 }

					tiny_flag = {
						datacontext = "[Invasion.GetInvaderCountry]"
						parentanchor = left|vcenter
						position = { 5 0 }

						blockoverride "onhover" {}
						using = tooltip_ws
					}

					flowcontainer = {
						parentanchor = right|vcenter
						position = { -25 0 }
						direction = vertical

						### FLEETS
						textbox = {
							visible = "[Invasion.IsNavalInvasion]"
							raw_text = "@flotillas! [Invasion.GetNumInvadingFleetsUnits|v]"
							alpha = "[TransparentIfZero_int32(Invasion.GetNumInvadingFleetsUnits)]"
							autoresize = yes
							align = right|nobaseline
							parentanchor = right
						}

						textbox = {
							raw_text = "@battalions! [Invasion.GetNumInvadingArmiesUnits|v]"
							alpha = "[TransparentIfZero_int32(Invasion.GetNumInvadingArmiesUnits)]"
							autoresize = yes
							align = right|nobaseline
							parentanchor = right
						}

					}
				}
			}

			### TARGET
			widget = {
				size = { 50% 100% }
				parentanchor = right|vcenter
				position = { 10 0 }

				icon = {
					parentanchor = right|vcenter
					using = colored_panel
					color = "[Invasion.GetInvadedCountry.GetMilitaryInterfaceColor]"
					alwaystransparent = yes
					size = { 120 50 }

					tiny_flag = {
						datacontext = "[Invasion.GetInvadedCountry]"
						parentanchor = right|vcenter
						position = { -5 0 }
						blockoverride "onhover" {}
					}

					flowcontainer = {
						parentanchor = vcenter
						position = { 25 0 }
						direction = vertical

						### FLEETS
						textbox = {
							visible = "[Invasion.IsNavalInvasion]"
							raw_text = "@flotillas! [Invasion.GetNumDefendingFleetsUnits|v]"
							alpha = "[TransparentIfZero_int32(Invasion.GetNumDefendingFleetsUnits)]"
							autoresize = yes
							align = nobaseline
						}

						textbox = {
                            raw_text = "@battalions! [Invasion.GetNumDefendingArmiesUnits|v]"
                            alpha = "[TransparentIfZero_int32(Invasion.GetNumDefendingArmiesUnits)]"
							autoresize = yes
							align = nobaseline
						}

					}
				}
			}
		}

		### INVASION ICON
		icon = {
			visible = "[Invasion.IsLandInvasion]"
			size = { 50 50 }
			texture = "gfx/interface/map_markers/land_invasion_marker.dds"
			parentanchor = bottom|hcenter

			round_progress_bad = {
				size = { 65% 65% }
				parentanchor = center
			}

			icon = {
				size = { 60% 60% }
				texture = "gfx/interface/backgrounds/round_button_bg.dds"
				parentanchor = center

				icon = {
					size = { 91% 91% }
					texture = "gfx/interface/icons/formation_order_icons/land_invasion.dds"
					parentanchor = center
				}
			}
		}

		icon = {
			visible = "[Invasion.IsNavalInvasion]"
			size = { 50 50 }
			texture = "gfx/interface/map_markers/naval_invasion_marker.dds"
			parentanchor = bottom|hcenter

			round_progress_bad = {
				size = { 65% 65% }
				parentanchor = center
			}

			icon = {
				size = { 60% 60% }
				texture = "gfx/interface/backgrounds/round_button_bg.dds"
				parentanchor = center

				icon = {
					size = { 91% 91% }
					texture = "gfx/interface/icons/formation_order_icons/naval_invasion.dds"
					parentanchor = center
				}

			}
		}
	}
}

### STATE EFFECT
flowcontainer = {
	name = "state_effect_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	parentanchor = bottom|hcenter

	container = {
		visible = "[Or(IsZoomLevelNear, State.IsBeingHighlighted)]"

		icon = {
			visible = "[State.GetStateRegion.HasDevastation]"
			datacontext = "[State.GetStateRegion]"
			tooltip = "TOOLTIP_STATE_DEVASTATION"
			texture = "gfx/interface/icons/state_status_icons/has_devastation.dds"
			size = { 30 30 }
		}

		icon = {
			visible = "[State.HasTurmoilEffects]"
			tooltip = "TOOLTIP_STATE_TURMOIL"
			texture = "gfx/interface/icons/state_status_icons/has_turmoil.dds"
			size = { 30 30 }
		}
	}
}

### STATE BUDGET BALANCE
container = {
	name = "state_budget_balance_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	using = small_nib
	blockoverride "nib_position" {
		position = { 0 -3 }
	}
	parentanchor = bottom|hcenter

	background = {
		using = default_background
	}

	flowcontainer = {
		margin = { 9 5 }
		direction = vertical

		textbox = {
			text = "UNINCORPORATED_ICON_WITH_CONCEPT"
			parentanchor = hcenter
			visible = "[State.IsUnincorporated]"
			autoresize = yes
			align = nobaseline
			using = fontsize_large
		}

		textbox = {
			raw_text = "@warning! [State.CalcTaxCapacityBalance|0+=]"
			visible = "[GreaterThan_CFixedPoint(State.CalcTaxCapacityUsage, State.CalcTaxCapacity)]"
			autoresize = yes
			align = nobaseline
			parentanchor = hcenter
			tooltip = "STATE_TAX_CAPACITY_DESC"
		}

		textbox = {
			visible = "[GreaterThan_CFixedPoint(State.GetTaxationRevenue, '(CFixedPoint)0')]"
			
			raw_text = "#variable [State.GetTaxationRevenue|+=d]#!"
			using = state_taxation_revenue_with_table

			autoresize = yes
			align = left|nobaseline
			parentanchor = hcenter
			using = fontsize_small
		}

		textbox = {
			visible = "[LessThan_CFixedPoint(State.GetGovernmentExpenses, '(CFixedPoint)0')]"
			autoresize = yes
			align = right|nobaseline
			raw_text = "#variable [State.GetGovernmentExpenses|+d]#!"
			using = state_government_expenses_with_table
			parentanchor = hcenter
			using = fontsize_small
		}
	}
}

### STATE MIGRATION TARGET
button = {
	name = "state_migration_target_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	using = small_nib
	parentanchor = bottom|hcenter

	background = {
		using = default_background
	}

	flowcontainer = {
		resizeparent = yes

		icon = {
			texture = "gfx/interface/icons/state_status_icons/mass_migration_target.dds"
			size = { 50 50 }
			tooltip = "TOOLTIP_MASS_MIGRATION_TARGET"
		}
	}
}

### POWER BLOC LEADER MAP MARKER
container = {
	name = "power_bloc_leader_marker"
	layer = layer_map_notifications # This is done to have the PB name map marker always show above the smaller PB map markers.
	datacontext = "[StateMarker.GetState]"
	datacontext = "[State.AccessOwner.AccessPowerBloc]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightPowerBloc(PowerBloc.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter
	using = clickthrough_blocker
	ignoreinvisible = yes
	alwaystransparent = no

	### Remove this if we ever add a right-click menu for Power Blocs
	onmousehierarchyenter = "[SetCanOpenRightClickContextMenu( '(bool)no' )]"
	onmousehierarchyleave = "[SetCanOpenRightClickContextMenu( '(bool)yes' )]"

	container = {
		resizeparent = yes
		parentanchor = hcenter
		using = tooltip_ne

		tooltipwidget = {
			FancyTooltip_PowerBloc = {}
		}

		### SMALLER VFX - RANK 1
		widget = {
			visible = "[And(IsZoomLevelFar, PowerBloc.IsRanked('(int32)1'))]"
			parentanchor = center
			size = { 45 45 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_01_map_marker
				}
			}
		}

		### SMALLER VFX - RANK 2
		widget = {
			visible = "[And(IsZoomLevelFar, PowerBloc.IsRanked('(int32)2'))]"
			parentanchor = center
			size = { 45 45 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				#There exists a "rank_01", "rank_02" and a "rank_03" vfx entity
				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_02_map_marker
				}
			}
		}

		### SMALLER VFX - RANK 3
		widget = {
			visible = "[And(IsZoomLevelFar, PowerBloc.IsRanked('(int32)3'))]"
			parentanchor = center
			size = { 45 45 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				#There exists a "rank_01", "rank_02" and a "rank_03" vfx entity
				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_03_map_marker
				}
			}
		}

		### BIGGER VFX - RANK 1
		widget = {
			visible = "[And(Not(IsZoomLevelFar), PowerBloc.IsRanked('(int32)1'))]"
			parentanchor = hcenter
			size = { 75 75 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_01_map_marker
				}
			}
		}

		### BIGGER VFX - RANK 2
		widget = {
			visible = "[And(Not(IsZoomLevelFar), PowerBloc.IsRanked('(int32)2'))]"
			parentanchor = hcenter
			size = { 75 75 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_02_map_marker
				}
			}
		}

		### BIGGER VFX - RANK 3
		widget = {
			visible = "[And(Not(IsZoomLevelFar), PowerBloc.IsRanked('(int32)3'))]"
			parentanchor = hcenter
			size = { 75 75 }

			vfx = {			
				blockoverride "parent_anchor" {
					parentanchor = center
				}

				blockoverride "size" {
					size = { 350% 350% }
				}

				blockoverride "entity_instance"{
					entity_instance = vfx_entity_ui_powerbloc_rank_03_map_marker
				}
			}
		}

		### SMALLER NAME LABEL
		widget = {
			visible = "[And(PowerBloc.IsBeingHighlighted, IsZoomLevelFar)]"
			size = { 0 30 }
			parentanchor = vcenter

			state = {
				name = _show
				size = { 190 30 }
				position_x = 60
				duration = 0.2
				alpha = 1
				using = Animation_Curve_FastSlow
			}
			state = {
				name = _hide
				size = { 0 30 }
				position_x = 40
				duration = 0.2
				alpha = 0
				using = Animation_Curve_FastSlow
			}

			widget = {
				size = { 80% 100% }
				parentanchor = right|vcenter

				### NAME LABEL VFX
				vfx = {
					blockoverride "size" {
						size = { 600% 600% }
					}
					blockoverride "parent_anchor" {
						parentanchor = center
					}
					blockoverride "entity_instance" {
						entity_instance = vfx_entity_ui_powerbloc_map_marker_name_label
					}			
				}

				button= {
					parentanchor = right|vcenter
					size = { 80% 100% }
					using = default_button_primary
					onclick = "[InformationPanelBar.OpenPowerBlocPanel(PowerBloc.Self)]"

					icon = {
						size = { 100% 100% }
						using = fade_left_simple
						alpha = 1

						modify_texture = {
							color = "[PowerBloc.GetPrimaryColor]"
						}
					}

					textbox = {
						parentanchor = center
						align = nobaseline
						autoresize = yes
						position = { 5 0 }
						max_width = 100
						elide = right
						fontsize_min = 14
						text = "[PowerBloc.GetNameNoFormatting]"
					}
				}
			}
		}

		### BIGGER NAME LABEL
		widget = {
			visible = "[And(Or(PowerBloc.IsBeingHighlighted, IsZoomLevelNear), Not(IsZoomLevelFar))]"
			size = { 0 40 }
			parentanchor = vcenter

			state = {
				name = _show
				size = { 210 40 }
				position_x = 80
				duration = 0.2
				alpha = 1
				using = Animation_Curve_FastSlow
			}
			state = {
				name = _hide
				size = { 0 40 }
				position_x = 40
				duration = 0.2
				alpha = 0
				using = Animation_Curve_FastSlow
			}

			widget = {
				size = { 80% 100% }
				parentanchor = right|vcenter

				### NAME LABEL VFX
				vfx = {
					blockoverride "size" {
						size = { 600% 600% }
					}
					blockoverride "parent_anchor" {
						parentanchor = center
					}
					blockoverride "entity_instance" {
						entity_instance = vfx_entity_ui_powerbloc_map_marker_name_label
					}			
				}

				button= {
					parentanchor = right|vcenter
					size = { 80% 100% }
					using = default_button_primary
					onclick = "[InformationPanelBar.OpenPowerBlocPanel(PowerBloc.Self)]"

					icon = {
						size = { 100% 100% }
						using = fade_left_simple
						alpha = 1

						modify_texture = {
							color = "[PowerBloc.GetPrimaryColor]"
						}
					}

					textbox = {
						parentanchor = center
						align = nobaseline
						autoresize = yes
						position = { 5 0 }
						max_width = 120
						elide = right
						fontsize_min = 14
						text = "[PowerBloc.GetNameNoFormatting]"
					}
				}
			}
		}

		### SMALLER EMBLEM
		power_bloc_icon = {
			visible = "[IsZoomLevelFar]"
			parentanchor = center
			size = { 45 45 }

			button = {
				size = { 100% 100% }
				onclick = "[InformationPanelBar.OpenPowerBlocPanel(PowerBloc.Self)]"
			}
		}

		### BIGGER EMBLEM
		power_bloc_icon = {
			visible = "[Not(IsZoomLevelFar)]"
			parentanchor = hcenter
			size = { 75 75 }
			
			button = {
				size = { 100% 100% }
				onclick = "[InformationPanelBar.OpenPowerBlocPanel(PowerBloc.Self)]"
			}
		}	
	}
}

### POWER BLOC COUNTRY INVITE MAP MARKER
container = {
	name = "power_bloc_country_invite_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState.GetOwner]"
	datacontext = "[Country.GetPowerBlocWithHighestLeverage]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightCountry(Country.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	flowcontainer = {
		direction = vertical
		parentanchor = hcenter

		power_bloc_icon = {
			parentanchor = hcenter
			size = { 30 30 }
			tooltip = "[Country.GetPowerBlocNonMemberCountryTooltip]"
		}
	}
}

### SPECIFIC POWER BLOC COUNTRY LEVERAGE MAP MARKER
container = {
	name = "specific_power_bloc_country_leverage_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState.GetOwner]"
	datacontext = "[PowerBlocPanel.GetSelectedPowerBloc]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightCountry(Country.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	container = {
		parentanchor = hcenter

		tooltipwidget = {
			RegularTooltip_Leverage = {
				blockoverride "has_power_bloc_context_visibility" {
					visible = yes
				}
			}
		}

		icon = {
			visible = "[Not(IsZoomLevelFar)]"
			size = { 45 45 }
			texture = "gfx/interface/map_markers/powerbloc_small_marker.dds"
		}

		icon = {
			visible = "[IsZoomLevelFar]"
			size = { 40 40 }
			texture = "gfx/interface/map_markers/powerbloc_small_marker.dds"
		}

		textbox = {
			parentanchor = center
			position = { 0 -2 }
			autoresize = yes
			align = nobaseline
			using = fontsize_small
			text = "[PowerBloc.GetLeverageAdvantage(Country.Self)|=+0]"
		}
	}
}

### ALL POWER BLOC COUNTRY LEVERAGE MAP MARKER
container = {
	name = "all_power_bloc_country_leverage_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState.GetOwner]"
	datacontext = "[StateMarker.GetState.GetOwner.GetPowerBlocWithHighestLeverage]"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightCountry(Country.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"
	parentanchor = bottom|hcenter

	flowcontainer = {
		direction = vertical
		parentanchor = hcenter

		power_bloc_icon = {
			parentanchor = hcenter
			size = { 30 30 }
			tooltip = "[Country.GetPowerBlocNonMemberCountryTooltip]"
		}
	}
}

### STRATEGIC OBJECTIVE
button = {
	name = "strategic_objective_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	parentanchor = bottom|hcenter
	tooltip = "STATE_STRATEGIC_OBJECTIVE_TOOLTIP"
	onmousehierarchyenter = "[AccessHighlightManager.HighlightStrategicObjective(State.Self)]"
	onmousehierarchyleave = "[AccessHighlightManager.RemoveHighlight]"

	icon = {
		parentanchor = bottom|hcenter
		size = { 11 8 }
		position = { 0 4 }
		texture = "/gfx/interface/map_markers/small_nib.dds"
	}

	flowcontainer = {
		resizeparent = yes

		icon = {
			visible = "[IsZoomLevelNear]"
			texture = "gfx/interface/icons/formation_order_icons/strategic_objective.dds"
			size = { 50 50 }
		}
		icon = {
			visible = "[Not(IsZoomLevelNear)]"
			texture = "gfx/interface/icons/formation_order_icons/strategic_objective.dds"
			size = { 36 36 }
		}
	}
}

### STATE PRICE OF GOODS
widget = {
	name = "state_price_of_goods_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	allow_outside = yes

	flowcontainer = {
		parentanchor = center
		margin = { 7 7 }
		direction = vertical
		datacontext = "[StateMarker.GetGoods.WithStateContext( State.Self )]"
		tooltip = "[Goods.GetStatePriceDesc]"
		alpha = "[TransparentIfFalse(Or(GreaterThan_CFixedPoint(Goods.GetStateProduction, '(CFixedPoint)0'), GreaterThan_CFixedPoint(Goods.GetStateConsumption, '(CFixedPoint)0')))]"

		textbox = {
			raw_text = "[SelectLocalization(Goods.HasGoodsShortage, '@goods_shortage!', '')][State.GetOwner.GetCustom('currency_symbol')][Goods.GetStatePrice|v0] [Goods.GetCompareIconAgainstBasePriceNoFormatting( Goods.GetStatePrice )]"
			autoresize = yes
			align = nobaseline
			parentanchor = hcenter
			using = fontsize_small

			background = {
				using = colored_panel_dark
				margin = { 5 2 }
				alpha = 0.7
			}
		}
	}
}

widget = {
	name = "state_potential_of_goods_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	allow_outside = yes

	flowcontainer = {
		parentanchor = center
		margin = { 7 7 }
		direction = vertical
		datacontext = "[StateMarker.GetGoods.WithStateContext( State.Self )]"
		
		textbox = {
			text = "[State.GetPotentialProductionForCountry(Goods.Self, GetPlayer.Self)|vD]"
			visible = "[GreaterThan_CFixedPoint(State.GetPotentialProductionForCountry(Goods.Self, GetPlayer.Self), '(CFixedPoint)0')]"
			autoresize = yes
			align = left|nobaseline
			parentanchor = hcenter
			using = fontsize_small

			background = {
				using = colored_panel_dark
				margin = { 5 1 }
				alpha = 0.7
			}
		}
	}
}

widget = {
	name = "state_production_of_goods_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	allow_outside = yes

	flowcontainer = {
		parentanchor = center
		margin = { 7 7 }
		direction = vertical
		datacontext = "[StateMarker.GetGoods.WithStateContext( State.Self )]"
		#tooltip = "[Goods.GetStatePriceDesc]"
		
		textbox = {
			text = "[State.GetNumProduced(Goods.Self)|0v]"
			visible = "[GreaterThan_CFixedPoint(State.GetNumProduced(Goods.Self), '(CFixedPoint)0')]"
			autoresize = yes
			align = left|nobaseline
			parentanchor = hcenter
			using = fontsize_small

			background = {
				using = colored_panel_dark
				margin = { 5 1 }
				alpha = 0.7
			}
		}
	}
}

widget = {
	name = "state_consumption_of_goods_marker"
	layer = layer_map_markers
	max_update_rate = 8
	datacontext = "[StateMarker.GetState]"
	allow_outside = yes

	flowcontainer = {
		parentanchor = center
		margin = { 7 7 }
		direction = vertical
		datacontext = "[StateMarker.GetGoods.WithStateContext( State.Self )]"
		
		textbox = {
			text = "[SelectLocalization(Goods.HasGoodsShortage, '@goods_shortage! ', '')][State.GetNumConsumed(Goods.Self)|0v]"
			visible = "[GreaterThan_CFixedPoint(State.GetNumConsumed(Goods.Self), '(CFixedPoint)0')]"
			autoresize = yes
			align = nobaseline
			parentanchor = hcenter
			using = fontsize_small

			background = {
				using = colored_panel_dark
				margin = { 5 1 }
				alpha = 0.7
			}
		}
	}
}

### TEMPLATES AND TYPES

template small_nib {
	container = {
		parentanchor = bottom|hcenter
		widgetanchor = top|hcenter

		block "nib_visibility" {}

		icon = {
			size = { 11 8 }
			block "nib_position" {
				position = { 0 0 }
			}
			texture = "/gfx/interface/map_markers/small_nib.dds"
			alpha = 1
		}
	}
}

template colored_panel
{
	texture = "gfx/interface/map_markers/colored_panel.dds"
	texture_density = 2
	spriteborder = { 10 10 }
	spriteType = Corneredtiled

	icon = {
		name = "shading"
		texture = "gfx/interface/map_markers/colored_panel_shading.dds"
		spriteType = Corneredstretched
		spriteborder = { 0 0 }
		size = { 100% 100% }
		alpha = 0.75

		modify_texture = {
			texture = "gfx/interface/map_markers/colored_panel.dds"
			texture_density = 2
			spriteType = Corneredtiled
			spriteborder = { 10 10 }
			blend_mode = alphamultiply
		}
	}

	icon = {
		name = "texture"
		texture = "gfx/interface/map_markers/colored_panel_texture.dds"
		size = { 100% 100% }
		spriteType = Corneredtiled
		spriteborder = { 0 0 }
		alpha = 0.5

		modify_texture = {
			texture = "gfx/interface/map_markers/colored_panel.dds"
			texture_density = 2
			spriteType = Corneredtiled
			spriteborder = { 10 10 }
			blend_mode = alphamultiply
		}
	}
}

template colored_panel_ui
{
	using = colored_panel
	alpha = 0.4
}

template colored_panel_dark
{
	using = colored_panel
	texture = "gfx/interface/map_markers/colored_panel_dark.dds"
}

template colored_panel_bright
{
	using = colored_panel
	texture = "gfx/interface/map_markers/colored_panel_bright.dds"
}

template transparent_if_unmobilized_in_conflict
{
	alpha = "[TransparentIfTrue(And(And(Not(MilitaryFormation.IsMobilized), MilitaryFormation.IsArmy), MilitaryFormation.GetCountry.IsInvolvedInActiveConflict))]"
}

template sea_node_framed_button_gfx
{
	gfxtype = framedbuttongfx
	effectname = "NoHighlight"
	upframe = 1
	overframe = 2
	downframe = 3
}

types map_marker_types
{
	type movement_marker_hover_vfx = widget {
		size = { 100% 100% }

		vfx = {			
			blockoverride "parent_anchor" {
				parentanchor = center
			}

			blockoverride "size" {
				size = { 1000% 1000% }
			}

			blockoverride "entity_instance"{
				block "vfx_entity_instance" {
					entity_instance = vfx_entity_ui_onhover_sea_node_formation_movement
				}
			}
		}
	}

	type movement_marker_click_vfx = widget {
		size = { 100% 100% }

		vfx = {
			name = "onrightclick_vfx"
			alpha = 0

			blockoverride "parent_anchor" {
				parentanchor = center
			}

			blockoverride "size" {
				size = { 1000% 1000% }
			}

			blockoverride "entity_instance"{
				block "vfx_entity_instance" {
					entity_instance = vfx_entity_ui_onclick_sea_node_formation_movement
				}
			}

			state = {
				name = "show"
				duration = 0.1
				alpha = 1
				using = Animation_Curve_Default
				next = "hold"
			}
			state = {
				name = "hold"
				duration = 0.5
				alpha = 1
				using = Animation_Curve_Default
				next = "hide"
			}
			state = {
				name = "hide"
				duration = 0.4
				alpha = 0
				using = Animation_Curve_Default
			}
		}
	}
}
